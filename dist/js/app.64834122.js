(function(e){function t(t){for(var a,l,o=t[0],i=t[1],c=t[2],d=0,m=[];d<o.length;d++)l=o[d],Object.prototype.hasOwnProperty.call(n,l)&&n[l]&&m.push(n[l][0]),n[l]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);u&&u(t);while(m.length)m.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],a=!0,o=1;o<r.length;o++){var i=r[o];0!==n[i]&&(a=!1)}a&&(s.splice(t--,1),e=l(l.s=r[0]))}return e}var a={},n={app:0},s=[];function l(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=a,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(r,a,function(t){return e[t]}.bind(null,a));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=i;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"0208":function(e,t,r){},"034f":function(e,t,r){"use strict";r("85ec")},"0c1a":function(e,t,r){},"0ca5":function(e,t,r){"use strict";r("0208")},"0e4b":function(e,t,r){},"123a":function(e,t,r){"use strict";r("c002")},"129f":function(e,t,r){"use strict";r("2b74")},"1d9d":function(e,t,r){"use strict";r("2dc6")},"1ff7":function(e,t,r){"use strict";r("e166")},"22d2":function(e,t,r){"use strict";r("9c1e")},"27b5":function(e,t,r){"use strict";r("ff1e")},"27e5":function(e,t,r){},"29fc":function(e,t,r){},"2b74":function(e,t,r){},"2dc6":function(e,t,r){},"2e45":function(e,t,r){"use strict";r("cf0c")},"34fc":function(e,t,r){"use strict";r("ac11")},"36ea":function(e,t,r){"use strict";r("7751")},"37dc":function(e,t,r){},"398e":function(e,t,r){},"3d11":function(e,t,r){"use strict";r("c4ae")},"3ee3":function(e,t,r){"use strict";r("dcb5")},"46ec":function(e,t,r){"use strict";r("92bb")},"46f9":function(e,t,r){},"4c85":function(e,t,r){"use strict";r("a4f7")},"4e3d":function(e,t,r){"use strict";r("d73e")},"4f41":function(e,t,r){},5562:function(e,t,r){e.exports=r.p+"img/touxiang.94f90dc1.jpg"},"56d7":function(e,t,r){"use strict";r.r(t);r("0fae");var a=r("9e2f"),n=r.n(a),s=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.isRouterAlive?r("router-view"):e._e()],1)},o=[],i={name:"app",provide:function(){return{reload:this.reload}},data:function(){return{isRouterAlive:!0}},methods:{reload:function(){this.isRouterAlive=!1,this.$nextTick((function(){this.isRouterAlive=!0}))}}},c=i,u=(r("034f"),r("2877")),d=Object(u["a"])(c,l,o,!1,null,null,null),m=d.exports,p=r("8c4f"),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginc"},[a("div",{staticClass:"card"},[a("img",{attrs:{width:"150px",src:r("cf05")}}),a("div",[a("el-form",{ref:"formData",staticClass:"form",attrs:{model:e.formData,rules:e.rules}},[a("el-form-item",{attrs:{prop:"username"}},[a("el-input",{staticClass:"input",attrs:{"prefix-icon":"el-icon-s-custom",placeholder:"请输入用户名"},model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username",t)},expression:"formData.username"}})],1),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{staticClass:"input",attrs:{"prefix-icon":"el-icon-key",placeholder:"请输入密码","show-password":""},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),a("el-form-item",{staticClass:"button"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.checkForm("formData")}}},[e._v("登录")]),a("el-button",{attrs:{type:"info"},on:{click:function(t){return e.reset("formData")}}},[e._v("重置")])],1)],1)],1)])])},f=[],g=(r("96cf"),r("1da1")),h=r("4328"),_=r.n(h),v={name:"Login",data:function(){return{formData:{username:"admin",password:"admin123"},rules:{username:{required:!0,message:"请输入用户名"},password:[{required:!0,message:"请输入密码"},{min:6,message:"密码长度不符"}]}}},methods:{checkForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=13;break}return e.next=3,t.$ajax.post("/login/",_.a.stringify(t.formData)).catch((function(){return t.$notify.error({title:"错误",message:"请检查网络连接"})}));case 3:if(a=e.sent,n=a.data,!n.access_token){e.next=12;break}return window.sessionStorage.setItem("token",n.access_token),window.sessionStorage.setItem("username",t.formData.username),e.next=10,t.$router.push("/index");case 10:e.next=13;break;case 12:t.$message.error("用户名或密码错误");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},reset:function(e){this.$refs[e].resetField}}},x=v,w=(r("46ec"),Object(u["a"])(x,b,f,!1,null,"4eb42672",null)),k=w.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-header",[a("div",[a("img",{attrs:{src:r("c5269")}}),a("span",[e._v("数据库运维管理平台")])]),a("div",[a("el-menu",{staticClass:"el-menu-demo",attrs:{mode:"horizontal","background-color":"#3c7799","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.handleSelect}},[a("el-badge",{attrs:{"is-dot":!(0==e.count||!e.count)}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[a("el-avatar",{attrs:{size:50,fit:"scale-down",src:r("5562")}}),a("span",{staticStyle:{color:"#fff","font-size":"15px"}},[e._v(e._s(e.username))])],1),e.isShow?a("el-menu-item",{attrs:{index:"1-1"},on:{click:e.toPending}},[a("el-badge",{attrs:{value:0!=e.count&&e.count?e.count:0,hidden:0==e.count||!e.count}},[a("i",{staticClass:"iconfont icon-daishenpizhishi",staticStyle:{"margin-right":"10px"}}),e._v("待审批 ")])],1):e._e(),a("el-menu-item",{attrs:{index:"1-2"},on:{click:function(t){e.dialogFormVisible=!0}}},[a("i",{staticClass:"el-icon-goods",staticStyle:{"margin-right":"10px"}}),e._v("修改密码 ")]),a("el-menu-item",{attrs:{index:"1-2"},on:{click:e.logout}},[a("i",{staticClass:"iconfont icon-tuichudenglu",staticStyle:{"margin-right":"10px"}}),e._v("退出 ")])],2)],1)],1)],1)]),a("el-container",[a("el-aside",{attrs:{width:e.isCollapse?"64px":"200px"}},[a("div",{staticClass:"asideCon",on:{click:e.rl}},[a("i",{class:e.rlicon})]),a("el-menu",{staticClass:"aside_menu",attrs:{"unique-opened":!0,collapse:e.isCollapse,"default-active":e.activeIndex,"background-color":"#3c7792",router:""},on:{select:e.handleSelect}},e._l(e.menulist,(function(t){return a("el-submenu",{key:t.id,attrs:{index:t.id+""}},[a("template",{slot:"title"},[a("i",{class:t.icon}),e._v(" "),a("span",[e._v(e._s(t.title))])]),e._l(t.children,(function(t){return a("el-menu-item",{attrs:{index:t.path}},[[a("i",{class:t.icon}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.title))])]],2)}))],2)})),1)],1),a("el-main",[a("router-view")],1)],1),a("el-dialog",{attrs:{title:"修改密码",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.form,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"旧密码",prop:"oldpassword"}},[a("el-input",{staticClass:"input",attrs:{"prefix-icon":"el-icon-key",placeholder:"请输入密码","show-password":""},model:{value:e.form.oldpassword,callback:function(t){e.$set(e.form,"oldpassword",t)},expression:"form.oldpassword"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"password"}},[a("el-input",{staticClass:"input",attrs:{"prefix-icon":"el-icon-key",placeholder:"请输入密码","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!1,e.mod_password()}}},[e._v("确 定")])],1)],1)],1)},$=[],R={name:"Index",data:function(){return{menulist:[],isCollapse:!1,username:"",asideWidth:"200px",rlicon:"el-icon-d-arrow-left",activeIndex:"0",count:0,isShow:!0,dialogFormVisible:!1,form:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:"",password:"",oldpassword:""},formLabelWidth:"120px",timer_pendingOrder:""}},created:function(){this.get_menu(),this.username=window.sessionStorage.getItem("username"),this.get_pendingOrder(),this.timer_pendingOrder=setInterval(this.get_pendingOrder,1e4)},methods:{toPending:function(){this.$router.push("/pending")},handleSelect:function(e,t){this.activeIndex=e},rl:function(){this.isCollapse?this.isCollapse=!1:this.isCollapse=!0,this.isCollapse?this.rlicon="el-icon-d-arrow-right":this.rlicon="el-icon-d-arrow-left"},logout:function(){window.sessionStorage.clear(),this.$router.push("/login")},get_pendingOrder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/pending/?offset=0&limit=1");case 2:return r=t.sent,a=r.data,t.next=6,e.$ajax.get("/data_export_pending/?offset=0&limit=1");case 6:n=t.sent,s=n.data,e.count=0,e.count+=a.total,e.count+=s.total;case 11:case"end":return t.stop()}}),t)})))()},get_menu:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/menu").catch((function(t){e.$message({type:"error",center:!0,message:"登录异常请重新登录"}),e.$router.push("/login")}));case 2:r=t.sent,a=r.data,a||e.$message.error("菜单获取失败"),e.menulist=a.data;case 6:case"end":return t.stop()}}),t)})))()},mod_password:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/mod_password/",e.form).catch((function(){e.$notify.error({title:"错误",message:"提交失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.$message({message:"恭喜你，修改成功",type:"success"});case 7:case"end":return t.stop()}}),t)})))()}}},q=R,j=(r("9a53"),r("22d2"),Object(u["a"])(q,y,$,!1,null,"2a8e1528",null)),D=j.exports,S=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("Dashboard")])],1),r("el-card",[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticStyle:{width:"600px",height:"280px"},attrs:{id:"row1_col1"}})]),r("el-col",{attrs:{span:6}},[r("div",{staticStyle:{width:"600px",height:"280px"},attrs:{id:"row1_col2"}})])],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticStyle:{width:"600px",height:"280px"},attrs:{id:"row1_col3"}})]),r("el-col",{attrs:{span:12}},[r("div",{staticStyle:{width:"600px",height:"280px"},attrs:{id:"row1_col4"}})])],1)],1)],1)},C=[],O=(r("4160"),r("b0c0"),r("b680"),r("159b"),r("d015"),{name:"Dashboard",data:function(){return{name_list:[],data_source:[]}},mounted:function(){this.showChart()},methods:{showChart:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/sqlcount/");case 2:return r=t.sent,a=r.data,e.data_source=a.data,e.data_source.forEach((function(t){e.name_list.push(t.name)})),n=e.$echarts.init(document.getElementById("row1_col1")),s={title:{text:"用户操作占比统计(累计值)",font:"30px 黑体",x:"30%",y:"90%"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:e.name_list},series:[{name:"sql统计",type:"pie",radius:"55%",center:["65%","40%"],data:e.data_source,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},n.setOption(s),t.next=11,e.showRow1Col2();case 11:case"end":return t.stop()}}),t)})))()},showRow1Col2:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/workorder/?offset=1&limit=1");case 2:return r=t.sent,a=r.data,n=e.$echarts.init(document.getElementById("row1_col2")),s=a.total,l=1,"已提交工单",o=[["#00d5ee","#076c83"],["#fe3f4f","#7d273a"]],i=["#0d263c","#26172c"],c=[.6,.5,.6],u={title:{text:"已提交SQL工单数(累计值)",x:"35%",y:"90%"},backgroundColor:"#fff",graphic:[{type:"group",left:"center",bottom:10}],series:[{type:"liquidFill",radius:"65%",center:["50%","40%"],data:c,color:o[l],outline:{show:!0,borderDistance:4,itemStyle:{borderWidth:2,borderColor:o[l][0]}},backgroundStyle:{borderWidth:2,borderColor:"#051c45",color:i[l],shadowColor:i[l],shadowBlur:5},label:{normal:{formatter:s.toFixed(0),textStyle:{fontSize:18},insideColor:"#fff"}}}]},n.setOption(u),t.next=15,e.showRow1Col3();case 15:case"end":return t.stop()}}),t)})))()},showRow1Col3:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/workorder_data_export/?offset=1&limit=1");case 2:return r=t.sent,a=r.data,n=e.$echarts.init(document.getElementById("row1_col3")),s=a.total,l=1,"已提交工单",o=[["#00d5ee","#076c83"],["#fe3f4f","#7d273a"]],i=["#0d263c","#26172c"],c=[.6,.5,.6],u={title:{text:"已提交数据导出工单数(累计值)",x:"35%",y:"90%"},backgroundColor:"#fff",graphic:[{type:"group",left:"center",bottom:10}],series:[{type:"liquidFill",radius:"65%",center:["50%","40%"],data:c,color:o[l],outline:{show:!0,borderDistance:4,itemStyle:{borderWidth:2,borderColor:o[l][0]}},backgroundStyle:{borderWidth:2,borderColor:"#051c45",color:i[l],shadowColor:i[l],shadowBlur:5},label:{normal:{formatter:s.toFixed(0),textStyle:{fontSize:18},insideColor:"#fff"}}}]},n.setOption(u),t.next=15,e.showRow1Col4();case 15:case"end":return t.stop()}}),t)})))()},showRow1Col4:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_query_log?offset=1&limit=1");case 2:r=t.sent,a=r.data,n=e.$echarts.init(document.getElementById("row1_col4")),s=a.total,l=1,"已提交查询数量",o=[["#00d5ee","#076c83"],["#fe3f4f","#7d273a"]],i=["#0d263c","#26172c"],c=[.6,.5,.6],u={title:{text:"已提交查询数量(累计值)",x:"35%",y:"90%"},backgroundColor:"#fff",graphic:[{type:"group",left:"center",bottom:10}],series:[{type:"liquidFill",radius:"65%",center:["50%","40%"],data:c,color:o[l],outline:{show:!0,borderDistance:4,itemStyle:{borderWidth:2,borderColor:o[l][0]}},backgroundStyle:{borderWidth:2,borderColor:"#051c45",color:i[l],shadowColor:i[l],shadowBlur:5},label:{normal:{formatter:s.toFixed(0),textStyle:{fontSize:18},insideColor:"#fff"}}}]},n.setOption(u);case 13:case"end":return t.stop()}}),t)})))()}}}),I=O,T=Object(u["a"])(I,S,C,!1,null,"69610b42",null),E=T.exports,V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("实例列表")])],1),r("el-card",[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{clearable:"","prefix-icon":"el-icon-search",placeholder:"输入实例名"},on:{clear:e.handlerClear,change:e.handlerChange},model:{value:e.queryInfo.ins_name,callback:function(t){e.$set(e.queryInfo,"ins_name",t)},expression:"queryInfo.ins_name"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:e.handlerAdd}},[e._v("添加")])],1)],1),r("el-table",{attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"序号",type:"index",width:"50px"}}),r("el-table-column",{attrs:{prop:"ins_name",label:"实例名称",sortable:"",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"user",label:"账号",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"host",label:"主机",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"port",label:"端口",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"type",label:"主从类型",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"===t.row.type?r("el-tag",{attrs:{type:"success"}},[e._v("master")]):r("el-tag",{attrs:{type:"info"}},[e._v("slave")])]}}])}),r("el-table-column",{attrs:{prop:"db_type",label:"数据库类型",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(r){return e.handlerEdit(t.row)}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return e.handlerDelete(t.row)}}}),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(r){return e.handlerClearBinlog(t.row)}}},[e._v("binlog清理 ")]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){e.dialogTableVisible_instance_monitor=!0,e.rowid=t.row.id}}},[e._v("实例监控 ")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.page,"page-sizes":[10,20,50,100],"page-size":e.queryInfo.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total,"hide-on-single-page":!0},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:e.autofocus?"添加新的实例":"编辑实例",visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[r("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRule,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"实例名称",prop:"ins_name"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-host",autofocus:e.autofocus,disabled:!e.autofocus,clearable:""},model:{value:e.formData.ins_name,callback:function(t){e.$set(e.formData,"ins_name",t)},expression:"formData.ins_name"}})],1),r("el-form-item",{attrs:{label:"主机地址",prop:"host"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-database",clearable:""},model:{value:e.formData.host,callback:function(t){e.$set(e.formData,"host",t)},expression:"formData.host"}})],1),r("el-form-item",{attrs:{label:"主机端口",prop:"port"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-duankoutance",clearable:""},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",e._n(t))},expression:"formData.port"}})],1),r("el-form-item",{attrs:{label:"账号",prop:"user"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-account",autofocus:""},model:{value:e.formData.user,callback:function(t){e.$set(e.formData,"user",t)},expression:"formData.user"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-password","show-password":"",clearable:""},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),r("el-form-item",{attrs:{label:"主从类型",prop:"type"}},[r("el-radio",{attrs:{label:"master"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[e._v("master")]),r("el-radio",{attrs:{label:"slave"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[e._v("slave")])],1),r("el-form-item",{attrs:{label:"数据库类型",prop:"db_type"}},[r("el-radio",{attrs:{label:"mysql"},model:{value:e.formData.db_type,callback:function(t){e.$set(e.formData,"db_type",t)},expression:"formData.db_type"}},[e._v("mysql")]),r("el-radio",{attrs:{label:"cassandra"},model:{value:e.formData.db_type,callback:function(t){e.$set(e.formData,"db_type",t)},expression:"formData.db_type"}},[e._v("cassandra")]),r("el-radio",{attrs:{label:"pgsql"},model:{value:e.formData.db_type,callback:function(t){e.$set(e.formData,"db_type",t)},expression:"formData.db_type"}},[e._v("pgsql")]),r("el-radio",{attrs:{label:"mongodb"},model:{value:e.formData.db_type,callback:function(t){e.$set(e.formData,"db_type",t)},expression:"formData.db_type"}},[e._v("mongodb")]),r("el-radio",{attrs:{label:"redis"},model:{value:e.formData.db_type,callback:function(t){e.$set(e.formData,"db_type",t)},expression:"formData.db_type"}},[e._v("redis")])],1),r("el-form-item",[r("el-row",{attrs:{gutter:15}},[r("el-col",{attrs:{span:10}},[r("el-button",{on:{click:function(t){return e.handleCancel()}}},[e._v("取消")]),e.autofocus?r("el-button",{attrs:{type:"info"},on:{click:e.resetForm}},[e._v("重置")]):e._e()],1),r("el-col",{attrs:{span:13}},[r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.headlerCheck("formRef")}}},[e._v("连接测试")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handlerCommit("formRef")}}},[e._v("确 定")])],1)],1)],1)],1)],1),r("el-dialog",{attrs:{title:e.dialogTitleBinlog,visible:e.dialogVisibleBinlog,width:"40%"},on:{"update:visible":function(t){e.dialogVisibleBinlog=t},close:e.handleCancelBlog}},[r("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRule,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"实例名称",prop:"ins_name"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-host",autofocus:e.autofocus,disabled:e.autofocus,clearable:""},model:{value:e.formData.ins_name,callback:function(t){e.$set(e.formData,"ins_name",t)},expression:"formData.ins_name"}})],1),r("el-form-item",{attrs:{label:"主机地址",prop:"host"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-database",disabled:"",clearable:""},model:{value:e.formData.host,callback:function(t){e.$set(e.formData,"host",t)},expression:"formData.host"}})],1),r("el-form-item",{attrs:{label:"主机端口",prop:"port",disabled:""}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-duankoutance",disabled:"",clearable:""},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",e._n(t))},expression:"formData.port"}})],1),r("el-form-item",{attrs:{label:"binlog",prop:"port"}},[r("el-select",{attrs:{placeholder:"请选择binlog"},model:{value:e.formData.binlog,callback:function(t){e.$set(e.formData,"binlog",t)},expression:"formData.binlog"}},e._l(e.formData.binlog_list,(function(e){return r("el-option",{key:e[0],attrs:{label:e,value:e[0]}})})),1)],1),r("p",[e._v("提示：该binlog前的所有binlog都会被删除！")]),r("el-form-item",[r("el-row",{attrs:{gutter:15}},[r("el-col",{attrs:{span:10}},[r("el-button",{on:{click:function(t){return e.handleCancelBlog()}}},[e._v("取消")])],1),r("el-col",{attrs:{span:13}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.del_binlog()}}},[e._v("确 定")])],1)],1)],1)],1)],1),r("el-dialog",{attrs:{title:"实例监控",visible:e.dialogTableVisible_instance_monitor},on:{"update:visible":function(t){e.dialogTableVisible_instance_monitor=t}}},[r("el-table",{attrs:{data:e.instance_monitor_data}},[r("el-table-column",{attrs:{property:"time",label:"时间"}}),r("el-table-column",{attrs:{label:" -QPS- -TPS- "}},[r("el-table-column",{attrs:{property:"ins",label:"ins"}}),r("el-table-column",{attrs:{property:"upd",label:"upd"}}),r("el-table-column",{attrs:{property:"del",label:"del"}}),r("el-table-column",{attrs:{property:"sel",label:"sel"}}),r("el-table-column",{attrs:{property:"iud",label:"iud"}})],1),r("el-table-column",{attrs:{label:" -Hit%- "}},[r("el-table-column",{attrs:{property:"lor",label:"lor"}}),r("el-table-column",{attrs:{property:"hit",label:"hit"}})],1),r("el-table-column",{attrs:{label:" -innodb rows status- "}},[r("el-table-column",{attrs:{property:"innodb_rows_inserted_diff",label:"ins"}}),r("el-table-column",{attrs:{property:"innodb_rows_updated_diff",label:"upd"}}),r("el-table-column",{attrs:{property:"innodb_rows_deleted_diff",label:"del"}}),r("el-table-column",{attrs:{property:"innodb_rows_read_diff",label:"read"}})],1),r("el-table-column",{attrs:{label:"-innodb bp pages status-"}},[r("el-table-column",{attrs:{property:"data",label:"data"}}),r("el-table-column",{attrs:{property:"free",label:"free"}}),r("el-table-column",{attrs:{property:"dirty",label:"dirty"}}),r("el-table-column",{attrs:{property:"flush",label:"flush"}})],1),r("el-table-column",{attrs:{label:"-innodb data status-"}},[r("el-table-column",{attrs:{property:"reads",label:"reads"}}),r("el-table-column",{attrs:{property:"writes",label:"writes"}}),r("el-table-column",{attrs:{property:"readed",label:"readed"}}),r("el-table-column",{attrs:{property:"written",label:"written"}})],1),r("el-table-column",{attrs:{label:"--innodb log--"}},[r("el-table-column",{attrs:{property:"innodb_os_log_fsyncs_diff",label:"fsyncs"}}),r("el-table-column",{attrs:{property:"innodb_os_log_written_diff",label:"written"}})],1),r("el-table-column",{attrs:{label:"his --log(byte)--  read --query--"}},[r("el-table-column",{attrs:{property:"list",label:"list"}}),r("el-table-column",{attrs:{property:"uflush",label:"uflush"}}),r("el-table-column",{attrs:{property:"uckpt",label:"uckpt"}}),r("el-table-column",{attrs:{property:"view",label:"view"}}),r("el-table-column",{attrs:{property:"inside",label:"inside"}}),r("el-table-column",{attrs:{property:"que",label:"que"}})],1),r("el-table-column",{attrs:{label:"--threads--"}},[r("el-table-column",{attrs:{property:"run",label:"run"}}),r("el-table-column",{attrs:{property:"con",label:"con"}}),r("el-table-column",{attrs:{property:"cre",label:"cre"}}),r("el-table-column",{attrs:{property:"cac",label:"cac"}})],1),r("el-table-column",{attrs:{label:"--bytes--"}},[r("el-table-column",{attrs:{property:"recv",label:"recv"}}),r("el-table-column",{attrs:{property:"send",label:"send"}})],1)],1)],1)],1)},z=[],H=(r("fb6a"),r("ac1f"),r("b85c")),L=(r("82da"),{data:function(){var e=function(e,t,r){if(!t)return r(new Error("请输入服务器地址"));e=/\d+\.\d+\.\d+\.\d+/g;return e.exec(t)?r():r(new Error("请输入正确的服务器地址"))};return{dialogTableVisible_instance_monitor:!1,instance_monitor_data:[],autofocus:!0,dialogTitle:"添加实例",dialogTitleBinlog:"清理Binlog日志",tableData:[],total:0,dialogVisible:!1,dialogVisibleBinlog:!1,formData:{id:0,ins_name:"",host:"",port:3306,user:"",password:"",type:"master",db_type:"mysql",status:"1",binlog_list:[],binlog:""},formRule:{ins_name:[{required:!0,message:"请输入实例名称",trigger:"blur"}],host:[{required:!0,message:"请输入服务器地址",trigger:"blur"},{validator:e,trigger:"blur"}],port:[{required:!0,message:"请输入服务器端口",trigger:"blur"},{type:"number",message:"端口只能是数字类型",trigger:"change"}],user:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择主从类型",trigger:"change"}],db_type:[{required:!0,message:"请选择数据库类型",trigger:"change"}]},queryInfo:{ins_name:"",page:1,limit:10},timer:"",rowid:""}},created:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getinstance();case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=setInterval,t.next=3,e.instance_monitor;case 3:t.t1=t.sent,e.timer=(0,t.t0)(t.t1,5e3);case 5:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){clearInterval(this.timer)},methods:{handlerClearBinlog:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.get("/binlog_list/?id=".concat(e.id));case 2:a=r.sent,n=a.data,t.formData=n.data.ins,t.formData.id=e.id,t.formData.binlog_list=n.data.binlog_list,t.dialogVisibleBinlog=!0,t.dialogTitleBinlog="清理Binlog日志",t.autofocusBinlog=!1;case 10:case"end":return r.stop()}}),r)})))()},handlerEdit:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.get("/instance/?id=".concat(e.id));case 2:a=r.sent,n=a.data,t.formData=n.data[0],t.dialogVisible=!0,t.dialogTitle="编辑实例",t.autofocus=!1;case 8:case"end":return r.stop()}}),r)})))()},handlerDelete:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.delete("/instance/?id=".concat(e.id));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.message.error("删除失败"));case 6:return r.next=8,t.getinstance();case 8:t.$message({type:"success",message:"删除成功!"});case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handlerCommit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.$message.error("请正确填写必要信息"));case 2:if(!t.autofocus){e.next=9;break}return e.next=5,t.$ajax.post("/instance/",t.formData).catch((function(){return t.$notify.error({title:"错误",message:"发起创建实例失败"})}));case 5:a=e.sent,n=a.data,e.next=13;break;case 9:return e.next=11,t.$ajax.patch("/instance/",t.formData).catch((function(){return t.$notify.error({title:"错误",message:"发起创建实例失败"})}));case 11:s=e.sent,n=s.data;case 13:if("success"===n.msg){e.next=15;break}return e.abrupt("return",t.$message.error(n.msg));case 15:return t.dialogVisible=!1,t.resetForm(),e.next=19,t.getinstance();case 19:return e.abrupt("return",t.autofocus?t.$message.success("添加实例成功"):t.$message.success("修改实例成功"));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},headlerCheck:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.$message.error("请正确填写必要信息"));case 2:return a=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.next=5,t.$ajax.post("/concheck/",t.formData);case 5:if(n=e.sent,s=n.data,"success"===s.msg){e.next=10;break}return a.close(),e.abrupt("return",t.$message.error(s.msg));case 10:return a.close(),e.abrupt("return",t.$message.success("连接成功"));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},handleCancel:function(){this.dialogVisible=!1},handleCancelBlog:function(){this.resetForm(),this.dialogVisibleBinlog=!1},resetForm:function(){this.formData.ins_name="",this.formData.host="",this.formData.port=3306,this.formData.user="",this.formData.password="",this.formData.type="master"},handlerAdd:function(){this.dialogVisible=!0,this.autofocus=!0},handleSizeChange:function(e){this.queryInfo.limit=e,this.getinstance()},handleCurrentChange:function(e){this.queryInfo.page=e,this.getinstance()},handlerChange:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/",{params:e.queryInfo});case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("查询实例失败"));case 6:n=Object(H["a"])(a.data),t.prev=7,n.s();case 9:if((s=n.n()).done){t.next=18;break}return l=s.value,t.next=13,e.$ajax.post("/concheck2/?id=".concat(l.id));case 13:o=t.sent,i=o.data,"success"===i.msg?e.$set(l,"status","1"):e.$set(l,"status","0");case 16:t.next=9;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](7),n.e(t.t0);case 23:return t.prev=23,n.f(),t.finish(23);case 26:e.tableData=a.data,e.total=a.total;case 28:case"end":return t.stop()}}),t,null,[[7,20,23,26]])})))()},handlerClear:function(){this.getinstance()},getinstance:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/",{params:e.queryInfo});case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("实例列表获取失败"));case 6:n=Object(H["a"])(a.data);try{for(n.s();!(s=n.n()).done;)l=s.value,e.$set(l,"status","1")}catch(o){n.e(o)}finally{n.f()}e.tableData=a.data,e.total=a.total;case 10:case"end":return t.stop()}}),t)})))()},del_binlog:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.formData.binlog){t.next=2;break}return t.abrupt("return",e.$message.error("请选择要清理的binlog"));case 2:return t.next=4,e.$ajax.post("/del_binlog/",{binlog:e.formData.binlog,id:e.formData.id});case 4:if(r=t.sent,a=r.data,"success"===a.msg){t.next=8;break}return t.abrupt("return",e.$message.error("清理失败"));case 8:e.$message({message:"清理成功",type:"success"}),e.dialogVisibleBinlog=!1;case 10:case"end":return t.stop()}}),t)})))()},instance_monitor:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.dialogTableVisible_instance_monitor){t.next=11;break}return t.next=3,e.$ajax.get("/instance_monitor/?id=".concat(e.rowid));case 3:if(r=t.sent,a=r.data,"success"===a.msg){t.next=7;break}return t.abrupt("return",e.$message.error("请求失败"));case 7:e.instance_monitor_data.unshift(a.data),e.instance_monitor_data=e.instance_monitor_data.slice(0,5),t.next=12;break;case 11:e.instance_monitor_data=[];case 12:case"end":return t.stop()}}),t)})))()}}}),U=L,F=(r("585a4"),Object(u["a"])(U,V,z,!1,null,"47d17efb",null)),P=F.exports,A=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("SQL执行")]),r("el-breadcrumb-item",[e._v("CRUD")])],1),r("el-card",[r("el-form",{ref:"queryRef",attrs:{model:e.queryInfo,rules:e.queryRules,"label-position":"left"}},[r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"实例名称/地址:",prop:"selectHost","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择实例地址"},on:{change:function(t){return e.get_db("queryRef")}},model:{value:e.queryInfo.selectHost,callback:function(t){e.$set(e.queryInfo,"selectHost",t)},expression:"queryInfo.selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"数据库:",prop:"selectDb","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{filterable:"",placeholder:"请选择数据库"},on:{change:e.getTable},model:{value:e.queryInfo.selectDb,callback:function(t){e.$set(e.queryInfo,"selectDb",t)},expression:"queryInfo.selectDb"}},e._l(e.dbs,(function(e){return r("el-option",{key:e.db,attrs:{value:e.db,label:e.db}})})),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"审批主管: ",prop:"manager","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择审批主管"},model:{value:e.queryInfo.manager,callback:function(t){e.$set(e.queryInfo,"manager",t)},expression:"queryInfo.manager"}},e._l(e.manager,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.username}})})),1)],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"审批DBA: ",prop:"dba","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择审批DBA"},model:{value:e.queryInfo.dba,callback:function(t){e.$set(e.queryInfo,"dba",t)},expression:"queryInfo.dba"}},e._l(e.dba,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.username}})})),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:16}},[r("el-form-item",{attrs:{label:"工单说明: ",prop:"remark","label-width":"150px"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.queryInfo.remark,expression:"queryInfo.remark"}],staticStyle:{width:"75%"},attrs:{rows:"3"},domProps:{value:e.queryInfo.remark},on:{input:function(t){t.target.composing||e.$set(e.queryInfo,"remark",t.target.value)}}})])],1)],1),r("el-row",[r("el-col",{attrs:{span:17}},[r("el-form-item",{attrs:{label:"SQL:",prop:"sql"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.queryInfo.sql,expression:"queryInfo.sql"}],ref:"mycode",attrs:{rows:"20"},domProps:{value:e.queryInfo.sql},on:{input:function(t){t.target.composing||e.$set(e.queryInfo,"sql",t.target.value)}}})])],1),r("el-col",{attrs:{span:7}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择表"},on:{change:e.getDesc},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabs,(function(e){return r("el-option",{key:e,attrs:{value:e,label:e}})})),1),r("ul",{staticStyle:{overflow:"auto"}},[r("el-collapse",{staticStyle:{"max-height":"450px"},attrs:{accordion:""},on:{change:e.getDesc},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabs,(function(e){return r("el-collapse-item",{key:e,staticStyle:{width:"100%"},attrs:{title:e,name:e}})})),1)],1)],1)],1),r("el-row",{attrs:{gutter:60}},[r("el-col",{staticStyle:{"margin-left":"50px"},attrs:{span:12}},[r("el-button",{attrs:{type:"danger"},on:{click:e.sqlFormat}},[e._v("格式化sql")]),r("el-button",{attrs:{type:"primary"},on:{click:e.alter_merge}},[e._v("alter合并")])],1),r("el-col",{attrs:{span:6}},[r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.resetForm("queryRef")}}},[e._v("重置")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.commitForm("queryRef")}}},[e._v("提交")])],1)],1)],1)],1),r("el-dialog",{attrs:{title:"SQL审核结果",width:"60%",visible:e.dialogVisible},on:{close:e.dialogClose}},[e._l(e.result,(function(t,a){return r("div",{key:a},[r("el-divider",[e._v("SQL "+e._s(a+1))]),e._l(t.split("\n"),(function(t,a){return""!==t?r("el-tag",{key:a},[e._v(e._s(t))]):e._e()}))],2)})),r("el-divider",[e._v("END")]),r("el-row",[r("el-col",{attrs:{push:18}},[r("el-button",{attrs:{type:"info"},on:{click:e.dialogClose}},[e._v("已知晓,返回修改sql")])],1)],1)],2)],1)},M=[],N=(r("99af"),r("b64b"),r("db05")),B=r.n(N),Q=r("1487"),W=r.n(Q),G=r("48cd"),X=r.n(G);r("4d63"),r("25f0"),r("5319");Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var K=r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Y={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{queryInfo:{selectHost:"",selectDb:"",sql:"",manager:"",dba:"",remark:""},activeName:"",options:[],dbs:[],queryRules:{selectHost:{required:!0,message:"请选择实例",trigger:"change"},selectDb:{required:!0,message:"请选择数据库",trigger:"change"},sql:{required:!0,message:"SQL不可为空",trigger:"blur"},manager:{required:!0,message:"选择主管",trigger:"blur"},dba:{required:!0,message:"选择dba",trigger:"blur"},remark:[{required:!0,message:"必须填写工单说明",trigger:"blur"},{min:10,max:100,message:"长度最少 10 个字符",trigger:"blur"}]},tabs:[],desc:"",dialogVisible:!1,result:[],manager:[],dba:[]}},mounted:function(){this.get_master_ins(),this.init(),this.get_approver()},methods:{get_approver:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_approver/").catch((function(){return e.$notify.error({title:"错误",message:"请求审批人失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取审批人失败"));case 6:e.manager=a.data.manager,e.dba=a.data.dba;case 8:case"end":return t.stop()}}),t)})))()},dialogClose:function(){this.dialogVisible=!1,this.result=[]},commitForm:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.queryInfo.sql=t.editor.getValue(),t.$refs[e].validate(function(){var r=Object(g["a"])(regeneratorRuntime.mark((function r(a){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a){r.next=2;break}return r.abrupt("return",t.$message.error("请选择/填写必要项"));case 2:return t.sqlFormat(),t.queryInfo.sql=t.editor.getValue(),r.next=6,t.$ajax.post("/inspect/",t.queryInfo).catch((function(){return t.$notify.error({title:"请求失败",message:"SQL发起审核失败"})}));case 6:if(n=r.sent,s=n.data,"success"===s.msg){r.next=10;break}return r.abrupt("return",t.$message.error("SQL审核失败"));case 10:s.data?(t.result=s.data,t.dialogVisible=!0):(t.$message.success("工单提交成功！"),t.resetForm(e));case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());case 2:case"end":return r.stop()}}),r)})))()},getDesc:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""===e.activeName){t.next=10;break}return t.next=3,e.$ajax.get("/get_desc/?id=".concat(e.queryInfo.selectHost,"&dbname=").concat(e.queryInfo.selectDb,"&table=").concat(e.activeName));case 3:return r=t.sent,a=r.data,e.desc=a.data[1],e.desc=W.a.highlight("sql",e.desc).value,t.next=9,e.$alert("<pre>"+e.desc+"</pre>",e.activeName,{dangerouslyUseHTMLString:!0});case 9:e.activeName="";case 10:case"end":return t.stop()}}),t)})))()},getTable:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_table/?id=".concat(e.queryInfo.selectHost,"&dbname=").concat(e.queryInfo.selectDb));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("库中数据表获取失败"));case 6:e.tabs=Object.keys(a.data.tables),e.editor.setOption("hintOptions",a.data);case 8:case"end":return t.stop()}}),t)})))()},resetForm:function(e){this.$refs[e].resetFields(),this.editor.setValue(""),this.tabs=[],this.dbs=[]},get_master_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_master_ins/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},get_db:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return""!==t.queryInfo.selectDb&&(t.queryInfo.selectDb=""),t.dbs=[],t.tabs=[],e.next=5,t.$ajax.get("/get_schema/?id=".concat(t.queryInfo.selectHost)).catch((function(){return t.$notify.error({title:"错误",message:"获取数据库失败，请检查实例连接配置"})}));case 5:if(r=e.sent,a=r.data,"success"===a.msg){e.next=9;break}return e.abrupt("return",t.$message.error("获取数据库失败，请检查实例连接状态"));case 9:t.dbs=a.data;case 10:case"end":return e.stop()}}),e)})))()},init:function(){this.editor=K.fromTextArea(this.$refs.mycode,{mode:"text/x-mysql",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,theme:"dracula",styleActiveLine:!0,autoRefresh:!0,foldGutter:!0,completeSingle:!1,placeholder:"-- Tips:请先选择环境、库名，这样可以在使用Tab键时有补全提示",extraKeys:{Tab:"autocomplete"},hintOptions:{tables:{}}}),this.editor.setSize("800px","450px")},sqlFormat:function(){this.editor.setValue(B.a.format(this.editor.getValue()))},alter_merge:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.queryInfo.sql=e.editor.getValue(),t.next=3,e.$ajax.post("/alter_merge/",{sql:e.queryInfo.sql}).catch((function(){return e.$notify.error({title:"请求失败",message:"alter合并失败"})}));case 3:if(r=t.sent,a=r.data,"success"===a.msg){t.next=7;break}return t.abrupt("return",e.$message.error("alter合并失败"));case 7:e.editor.setValue(a.data.sql);case 8:case"end":return t.stop()}}),t)})))()}}},J=Y,Z=(r("36ea"),Object(u["a"])(J,A,M,!1,null,null,null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("SQL执行")]),r("el-breadcrumb-item",[e._v("SELECT")])],1),r("el-card",[r("el-form",{ref:"queryRef",attrs:{model:e.queryInfo,rules:e.queryRules}},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{xs:6,sm:6,md:6,lg:6,xl:6,span:6}},[r("el-form-item",{attrs:{label:"实例名称/地址:",prop:"selectHost"}},[r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择实例地址"},on:{change:function(t){return e.get_db("queryRef")}},model:{value:e.queryInfo.selectHost,callback:function(t){e.$set(e.queryInfo,"selectHost",t)},expression:"queryInfo.selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1)],1),r("el-col",{attrs:{xs:6,sm:6,md:6,lg:6,xl:6,span:6}},[r("el-form-item",{attrs:{label:"数据库:",prop:"selectDb"}},[r("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择数据库"},on:{change:e.getTable},model:{value:e.queryInfo.selectDb,callback:function(t){e.$set(e.queryInfo,"selectDb",t)},expression:"queryInfo.selectDb"}},e._l(e.dbs,(function(e){return r("el-option",{key:e.db,attrs:{value:e.db,label:e.db}})})),1)],1)],1),r("el-col",{attrs:{xs:6,sm:6,md:6,lg:6,xl:6,span:6}},[r("el-form-item",{attrs:{label:"限制条数:",prop:"limit2"}},[r("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择限制条数"},model:{value:e.queryInfo.limit2,callback:function(t){e.$set(e.queryInfo,"limit2",t)},expression:"queryInfo.limit2"}},e._l([10,100,500,1e3,1e4],(function(e){return r("el-option",{key:e,attrs:{value:e,label:e}})})),1)],1)],1),r("el-col",{attrs:{xs:6,sm:6,md:6,lg:6,xl:6,span:6}},[r("el-switch",{staticStyle:{height:"40px"},attrs:{"active-text":"开启sql检查","inactive-text":"关闭sql检查"},model:{value:e.switchValue,callback:function(t){e.switchValue=t},expression:"switchValue"}})],1)],1),r("el-row",[r("el-col",{attrs:{span:17}},[r("el-form-item",{attrs:{label:"SQL:",prop:"sql"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.queryInfo.sql,expression:"queryInfo.sql"}],ref:"mycode",attrs:{rows:"20"},domProps:{value:e.queryInfo.sql},on:{input:function(t){t.target.composing||e.$set(e.queryInfo,"sql",t.target.value)}}})])],1),r("el-col",{attrs:{span:7}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择表"},on:{change:e.getDesc},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabs,(function(e){return r("el-option",{key:e,attrs:{value:e,label:e}})})),1),r("ul",{staticStyle:{overflow:"auto"}},[r("el-collapse",{staticStyle:{"max-height":"450px"},attrs:{accordion:""},on:{change:e.getDesc},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabs,(function(e){return r("el-collapse-item",{key:e,attrs:{title:e,name:e}})})),1)],1)],1)],1),r("el-row",{attrs:{gutter:60}},[r("el-col",{staticStyle:{"margin-left":"50px"},attrs:{span:12}},[r("el-button",{attrs:{type:"danger"},on:{click:e.sqlFormat}},[e._v("格式化sql")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.switchValue=!0,e.commitForm("queryRef")}}},[e._v("获取sql优化建议")])],1),r("el-col",{attrs:{span:6}},[r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.resetForm("queryRef")}}},[e._v("重置")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.switchValue=!1,e.commitForm("queryRef")}}},[e._v("提交")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible_data_export=!0}}},[e._v("查询数据导出")])],1)],1)],1),e.isRet?r("div",[e.isFetching?r("el-divider",[e._v(" 数据获取中 "),r("i",{staticClass:"el-icon-loading"})]):r("el-divider",[e._v(" 结果集如下 "),r("i",{staticClass:"el-icon-s-opportunity"})]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},e._l(e.tableLabel,(function(e){return r("el-table-column",{key:e,attrs:{align:"center","header-align":"center",prop:e,label:e,"show-overflow-tooltip":"","min-width":"200px"}})})),1)],1):e._e()],1),r("el-dialog",{attrs:{title:"SQL审核结果",visible:e.dialogVisible,width:"75%"},on:{close:e.closeDialog}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"min-height":"500px"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("markdown-it-vue",{attrs:{content:e.result}}),e.loading?e._e():r("el-row",[r("el-col",{attrs:{push:18}},[r("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("返回优化SQL")]),r("el-button",{attrs:{type:"primary"},on:{click:e.getRes}},[e._v("仍然执行")])],1)],1)],1)]),r("el-dialog",{attrs:{title:"查询数据导出",visible:e.dialogFormVisible_data_export},on:{"update:visible":function(t){e.dialogFormVisible_data_export=t}}},[r("el-form",{ref:"queryRef1",attrs:{model:e.queryInfo,rules:e.queryRules1}},[r("el-form-item",{attrs:{label:"审批主管: ",prop:"manager","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择审批主管"},model:{value:e.queryInfo.manager,callback:function(t){e.$set(e.queryInfo,"manager",t)},expression:"queryInfo.manager"}},e._l(e.manager,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.username}})})),1)],1),r("el-form-item",{attrs:{label:"审批DBA: ",prop:"dba","label-width":"150px"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择审批DBA"},model:{value:e.queryInfo.dba,callback:function(t){e.$set(e.queryInfo,"dba",t)},expression:"queryInfo.dba"}},e._l(e.dba,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.username}})})),1)],1),r("el-form-item",{attrs:{label:"导出说明: ",prop:"remark","label-width":"150px"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.queryInfo.remark,expression:"queryInfo.remark"}],staticStyle:{width:"250px"},attrs:{rows:"5"},domProps:{value:e.queryInfo.remark},on:{input:function(t){t.target.composing||e.$set(e.queryInfo,"remark",t.target.value)}}})])],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible_data_export=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sumit_data_export("queryRef","queryRef1")}}},[e._v("提交导出工单")])],1)],1),r("el-dialog",{attrs:{title:"sql记事本",visible:e.outerVisible},on:{"update:visible":function(t){e.outerVisible=t}}},[r("el-dialog",{attrs:{width:"30%",title:"添加sql",visible:e.innerVisible,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.outerVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.innerVisible=!0}}},[e._v("添加sql")])],1)],1)],1)},re=[],ae=(r("c975"),r("a15b"),r("56b3"));r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var ne={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{queryInfo:{selectHost:"",selectDb:"",sql:"",offset:1,limit:10,limit2:10,manager:"",dba:"",remark:""},activeName:"",switchValue:!1,options:[],dbs:[],queryRules:{selectHost:{required:!0,message:"请选择实例",trigger:"change"},selectDb:{required:!0,message:"请选择数据库",trigger:"change"},sql:{required:!0,message:"SQL不可为空",trigger:"blur"},limit2:{required:!0,message:"必须要选择限制条数",trigger:"change"}},queryRules1:{manager:{required:!0,message:"选择主管",trigger:"blur"},dba:{required:!0,message:"选择dba",trigger:"blur"},remark:[{required:!0,message:"必须填写导出说明",trigger:"blur"},{min:10,max:100,message:"长度最少 10 个字符",trigger:"blur"}]},tabs:[],desc:"",dialogVisible:!1,dialogFormVisible_data_export:!1,result:"",loading:!0,tableData:[],total:0,tableLabel:[],isRet:!1,isFetching:!0,manager:[],dba:[],search_tablename:"",outerVisible:!1,innerVisible:!1}},mounted:function(){this.get_ins(),this.init(),this.get_approver()},methods:{get_approver:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_approver_data_export/").catch((function(){return e.$notify.error({title:"错误",message:"请求审批人失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取审批人失败"));case 6:e.manager=a.data.manager,e.dba=a.data.dba;case 8:case"end":return t.stop()}}),t)})))()},handleCurrentChange:function(e){console.log(this.queryInfo.offset),this.queryInfo.offset=e,this.getRes()},handleSizeChange:function(e){this.queryInfo.limit=e,this.queryInfo.offset=1,this.getRes()},getRes:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isRet=!0,e.isFetching=!0,e.dialogVisible=!1,t.next=5,e.$ajax.post("/sqlexec/",e.queryInfo).catch((function(){e.$notify.error({title:"错误",message:"获取结果失败"})}));case 5:if(r=t.sent,a=r.data,"success"===a.msg){t.next=10;break}return e.isRet=!1,t.abrupt("return",e.$message.error(a.msg));case 10:for(n in a.data)for(s in a.data[n])-1!==s.indexOf(".")&&(l=s.replace("."," "),a.data[n][l]=a.data[n][s]);e.tableData=a.data,e.total=a.total,0!==a.total&&(e.tableLabel=Object.keys(a.data[0])),e.isFetching=!1;case 15:case"end":return t.stop()}}),t)})))()},sumit_data_export:function(e,t){var r=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r.queryInfo.offset=1,r.queryInfo.limit=10,r.tableData=[],r.tableLabel=[],r.total=0,r.queryInfo.sql=r.editor.getValue(),r.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",r.$message.error("请选择/填写必要项"));case 2:r.$refs[t].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",r.$message.error("请选择/填写必要项"));case 2:return e.next=4,r.$ajax.post("/submit_workorder_data_export/",r.queryInfo).catch((function(){r.$notify.error({title:"错误",message:"请求失败"})}));case 4:if(a=e.sent,n=a.data,"success"===n.msg){e.next=9;break}return r.isRet=!1,e.abrupt("return",r.$message.error(n.msg));case 9:r.$message({type:"success",message:"提交数据导出工单成功!"}),r.dialogFormVisible_data_export=!1;case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return a.stop()}}),a)})))()},closeDialog:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogVisible=!1,e.result="",e.loading=!0;case 3:case"end":return t.stop()}}),t)})))()},commitForm:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.queryInfo.offset=1,t.queryInfo.limit=10,t.tableData=[],t.tableLabel=[],t.total=0,t.sqlFormat(),t.queryInfo.sql=t.editor.getValue(),t.$refs[e].validate(function(){var r=Object(g["a"])(regeneratorRuntime.mark((function r(a){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a){r.next=2;break}return r.abrupt("return",t.$message.error("请选择/填写必要项"));case 2:if(!t.switchValue){r.next=14;break}return t.dialogVisible=!0,r.next=6,t.$ajax.post("/sqlscore/",t.queryInfo).catch((function(){t.$notify.error({title:"错误",message:"提交失败"})}));case 6:if(n=r.sent,s=n.data,"success"===s.msg){r.next=10;break}return r.abrupt("return",t.$message.error("SQL审核失败"));case 10:t.result=s.data.join(""),t.loading=!1,r.next=16;break;case 14:return r.next=16,t.getRes(e);case 16:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());case 8:case"end":return r.stop()}}),r)})))()},getDesc:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""===e.activeName){t.next=10;break}return t.next=3,e.$ajax.get("/get_desc/?id=".concat(e.queryInfo.selectHost,"&dbname=").concat(e.queryInfo.selectDb,"&table=").concat(e.activeName));case 3:return r=t.sent,a=r.data,e.desc=a.data[1],e.desc=W.a.highlight("sql",e.desc).value,t.next=9,e.$alert("<pre>"+e.desc+"</pre>",e.activeName,{dangerouslyUseHTMLString:!0});case 9:e.activeName="";case 10:case"end":return t.stop()}}),t)})))()},getTable:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_table/?id=".concat(e.queryInfo.selectHost,"&dbname=").concat(e.queryInfo.selectDb));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("库中数据表获取失败"));case 6:e.tabs=Object.keys(a.data.tables),e.editor.setOption("hintOptions",a.data);case 8:case"end":return t.stop()}}),t)})))()},resetForm:function(e){this.isRet=!1,this.$refs[e].resetFields(),this.editor.setValue(""),this.tabs=[],this.dbs=[],this.switchValue=!0},get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_ins/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},get_db:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return""!==t.queryInfo.selectDb&&(t.queryInfo.selectDb=""),t.dbs=[],t.tabs=[],e.next=5,t.$ajax.get("/get_schema/?id=".concat(t.queryInfo.selectHost)).catch((function(){return t.$notify.error({title:"错误",message:"获取数据库失败，请检查实例连接配置"})}));case 5:if(r=e.sent,a=r.data,"success"===a.msg){e.next=9;break}return e.abrupt("return",t.$message.error("获取数据库失败，请检查实例连接状态"));case 9:t.dbs=a.data;case 10:case"end":return e.stop()}}),e)})))()},init:function(){this.editor=ae.fromTextArea(this.$refs.mycode,{mode:"text/x-mysql",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,theme:"dracula",styleActiveLine:!0,autoRefresh:!0,foldGutter:!0,completeSingle:!1,placeholder:"-- Tips:请先选择环境、库名，这样可以在使用Tab键时有补全提示",extraKeys:{Tab:"autocomplete"},hintOptions:{tables:{}}}),this.editor.setSize("800px","450px")},sqlFormat:function(){this.editor.setValue(B.a.format(this.editor.getValue()))}}},se=ne,le=(r("dcef"),Object(u["a"])(se,te,re,!1,null,"48d0d6ae",null)),oe=le.exports,ie=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("权限管理")]),r("el-breadcrumb-item",[e._v("角色列表")])],1),r("el-card",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入角色名",clearable:""},on:{change:e.inputChange},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增")])],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"",data:e.tableData}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-table",{attrs:{size:"mini",border:"",stripe:"",data:t.row.ins}},[r("el-table-column",{attrs:{label:"#",type:"index",width:"100px",align:"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",width:"200px",align:"center"}}),r("el-table-column",{attrs:{label:"操作权限",prop:"privileges",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-checkbox-group",{on:{change:function(r){return e.priCommit(t.row)}},model:{value:t.row.privileges,callback:function(r){e.$set(t.row,"privileges",r)},expression:"scope.row.privileges"}},[r("el-checkbox",{attrs:{label:"select",border:"",size:"mini",disabled:""}}),r("el-checkbox",{attrs:{label:"insert",border:"",size:"mini",disabled:"slave"==t.row.type}}),r("el-checkbox",{attrs:{label:"update",border:"",size:"mini",disabled:"slave"==t.row.type}}),r("el-checkbox",{attrs:{label:"delete",border:"",size:"mini",disabled:"slave"==t.row.type}}),r("el-checkbox",{attrs:{label:"alter",border:"",size:"mini",disabled:"slave"==t.row.type}}),r("el-checkbox",{attrs:{label:"create",border:"",size:"mini",disabled:"slave"==t.row.type}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{label:"删除操作",width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return e.delInstance(t.row)}}})]}}],null,!0)})],1)]}}])}),r("el-table-column",{attrs:{label:"序号",type:"index",align:"center","header-align":"center",width:"200px"}}),r("el-table-column",{attrs:{label:"角色名称",prop:"role",align:"center"}}),r("el-table-column",{attrs:{label:"部门名称",prop:"department",align:"center"}}),r("el-table-column",{attrs:{label:"编辑",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",disabled:"admin"===t.row.role},on:{click:function(r){return e.handlerEdit(t.row)}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:"admin"===t.row.role},on:{click:function(r){return e.deleteRole(t.row)}}}),r("el-button",{attrs:{type:"info",icon:"el-icon-plus",size:"mini",disabled:"admin"===t.row.role},on:{click:function(r){return e.addPri(t.row)}}},[e._v("新增实例权限")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.offset,"page-sizes":[10,20,50,100],"page-size":e.queryInfo.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total,"hide-on-single-page":!0},on:{"size-change":e.handlerSizeChange,"current-change":e.handlerCurrentChange}}),r("el-dialog",{attrs:{visible:e.dialogVisible,width:"30%",title:e.isEdit?"编辑角色":"新增角色"},on:{close:function(t){return e.dialogClose("formRef")}}},[r("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRule,"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"role"}},[r("el-select",{staticStyle:{width:"340.8px"},attrs:{placeholder:"请选择角色"},model:{value:e.formData.role,callback:function(t){e.$set(e.formData,"role",t)},expression:"formData.role"}},[r("el-option",{attrs:{label:"admin",value:"admin"}}),r("el-option",{attrs:{label:"DBA",value:"DBA"}}),r("el-option",{attrs:{label:"主管",value:"主管"}}),r("el-option",{attrs:{label:"员工",value:"员工"}})],1)],1),r("el-form-item",{attrs:{label:"部门名称",prop:"department"}},[r("el-input",{model:{value:e.formData.department,callback:function(t){e.$set(e.formData,"department",t)},expression:"formData.department"}})],1),r("el-form-item",[r("el-row",[r("el-col",{attrs:{push:4,span:8}},[r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.dialogClose("formRef")}}},[e._v("取消")])],1),r("el-col",{attrs:{push:4,span:8}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handlerCommit("formRef")}}},[e._v("提交")])],1)],1)],1)],1)],1),r("el-dialog",{attrs:{title:e.addPriTitle[1],width:"60%",visible:e.addPriVisible},on:{close:e.addPriCancel}},[r("el-form",{ref:"addPriRef",attrs:{model:e.addPriData}},[r("el-row",[r("el-form-item",[r("el-col",{attrs:{span:8}},[r("el-select",{attrs:{placeholder:"请选择实例",clearable:""},model:{value:e.addPriData.instance_id,callback:function(t){e.$set(e.addPriData,"instance_id",t)},expression:"addPriData.instance_id"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{label:e.ins_name,value:e.id}})})),1)],1),r("el-col",{attrs:{span:16}},[r("el-checkbox-group",{model:{value:e.addPriData.privileges,callback:function(t){e.$set(e.addPriData,"privileges",t)},expression:"addPriData.privileges"}},[r("el-checkbox",{attrs:{label:"select",border:"",size:"mini",disabled:""}}),r("el-checkbox",{attrs:{label:"insert",border:"",size:"mini",disabled:e.status}}),r("el-checkbox",{attrs:{label:"update",border:"",size:"mini",disabled:e.status}}),r("el-checkbox",{attrs:{label:"delete",border:"",size:"mini",disabled:e.status}}),r("el-checkbox",{attrs:{label:"alter",border:"",size:"mini",disabled:e.status}}),r("el-checkbox",{attrs:{label:"create",border:"",size:"mini",disabled:e.status}})],1)],1)],1)],1),r("el-row",[r("el-form-item",[r("el-col",{attrs:{push:18}},[r("el-button",{attrs:{type:"info"},on:{click:e.addPriCancel}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.addPriConfirm}},[e._v("确定")])],1)],1)],1)],1)],1)],1)],1)},ce=[],ue=(r("1276"),{name:"Role",data:function(){return{inputValue:"",tableData:[],queryInfo:{role:"",offset:1,limit:10},total:0,dialogVisible:!1,formData:{role:"",department:""},formRule:{role:[{required:!0,message:"请输入角色名称",trigger:"blur"}],department:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},isEdit:!1,addPriVisible:!1,checkList:[],options:[],addPriTitle:[],addPriData:{instance_id:"",role_id:"",privileges:["select"]}}},computed:{status:function(){var e,t=this;if(""!==this.addPriData.instance_id){try{this.options.forEach((function(r){if(r.id===t.addPriData.instance_id&&"slave"===r.type)throw e=!0,Error();e=!1}))}catch(r){}return e}}},mounted:function(){this.getRoles()},methods:{delInstance:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$confirm("此操作将删除该对象对该实例全部操作, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.delete("/rights/?pri_id=".concat(e.privilege_id));case 2:if(a=r.sent,n=a.data,"success"==n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("删除实例权限失败"));case 6:t.getRoles(),t.$message({type:"success",message:"删除实例权限成功!"});case 8:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}));case 1:case"end":return r.stop()}}),r)})))()},priCommit:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.privileges.join(","),console.log(e),r.next=4,t.$ajax.patch("/rights/?pri_id=".concat(e.privilege_id,"&pri=").concat(a));case 4:if(n=r.sent,s=n.data,"success"==s.msg){r.next=8;break}return r.abrupt("return",t.$message("实例"+e.ins_name+"权限修改失败"));case 8:case"end":return r.stop()}}),r)})))()},addPriConfirm:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.addPriData.role_id=e.addPriTitle[0],e.addPriData.privileges=e.addPriData.privileges.join(","),t.next=4,e.$ajax.post("/rights/",e.addPriData);case 4:if(r=t.sent,a=r.data,"success"==a.msg){t.next=8;break}return t.abrupt("return",e.$message.error("添加权限失败"));case 8:e.$message.success("添加权限成功"),e.addPriCancel(),e.getRoles();case 11:case"end":return t.stop()}}),t)})))()},addPriCancel:function(){this.addPriVisible=!1,this.addPriData.instance_id="",this.role_id="",this.addPriData.privileges=["select"]},addPri:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.addPriTitle=[e.id,"为角色"+e.role+"新增实例权限"],t.addPriVisible=!0,r.next=4,t.$ajax.get("/partins/?role_id=".concat(e.id));case 4:if(a=r.sent,n=a.data,"success"==n.msg){r.next=8;break}return r.abrupt("return",t.$message.error("获取实列失败"));case 8:t.options=n.data;case 9:case"end":return r.stop()}}),r)})))()},handlerEdit:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.get("/role/?id=".concat(e.id));case 2:a=r.sent,n=a.data,t.formData=n.data,t.dialogVisible=!0,t.isEdit=!0;case 7:case"end":return r.stop()}}),r)})))()},deleteRole:function(e){var t=this;this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.delete("/role/?id=".concat(e.id));case 2:if(a=r.sent,n=a.data,"success"==n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("删除角色失败"));case 6:t.getRoles(),t.$message({type:"success",message:"角色删除成功!"});case 8:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handlerCommit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.$message.error("请正确填写必要项"));case 2:if(!t.isEdit){e.next=12;break}return e.next=5,t.$ajax.patch("/role/",t.formData);case 5:if(a=e.sent,n=a.data,"success"==n.msg){e.next=9;break}return e.abrupt("return",t.$message.error("修改角色失败"));case 9:t.$message.success("修改角色成功"),e.next=19;break;case 12:return e.next=14,t.$ajax.post("/role/",t.formData).catch((function(){return t.$notify.error({title:"错误",message:"发起添加角色失败"})}));case 14:if(s=e.sent,n=s.data,"success"==n.msg){e.next=18;break}return e.abrupt("return",t.$message.error("添加角色失败"));case 18:t.$message.success("添加角色成功");case 19:t.dialogVisible=!1,t.getRoles();case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},dialogClose:function(e){this.dialogVisible=!1,this.formData.role="",this.formData.department="",this.isEdit=(this.isEdit,!1)},inputChange:function(){this.queryInfo.role=this.inputValue,this.getRoles()},handlerSizeChange:function(e){this.queryInfo.limit=e,this.getRoles()},handlerCurrentChange:function(e){this.queryInfo.offset=e,this.getRoles()},getRoles:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/role/",{params:e.queryInfo});case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取角色列表失败"));case 6:a.data.forEach((function(e){e.ins.forEach((function(e){e.privileges=e.privileges.split(",")}))})),e.tableData=a.data,e.total=a.total;case 9:case"end":return t.stop()}}),t)})))()}}}),de=ue,me=(r("3d11"),Object(u["a"])(de,ie,ce,!1,null,"3c381a51",null)),pe=me.exports,be=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("权限管理")]),r("el-breadcrumb-item",[e._v("用户列表")])],1),r("el-card",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入用户名",clearable:""},on:{change:e.inputChange},model:{value:e.queryInfo.user,callback:function(t){e.$set(e.queryInfo,"user",t)},expression:"queryInfo.user"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:e.handlerAddUser}},[e._v(" 添加 ")])],1)],1),r("el-table",{attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100px"}}),r("el-table-column",{attrs:{label:"用户",prop:"username",align:"center"}}),r("el-table-column",{attrs:{label:"邮箱",prop:"email",align:"center"}}),r("el-table-column",{attrs:{label:"角色",prop:"role",align:"center"}}),r("el-table-column",{attrs:{label:"部门",prop:"department",align:"center"}}),r("el-table-column",{attrs:{label:"状态",prop:"status",align:"center",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(e){return["正常"==e.row.status?r("el-tag",{attrs:{type:"success"}},[r("span",{staticClass:"el-icon-success"})]):r("el-tag",{attrs:{type:"danger"}},[r("span",{staticClass:"el-icon-error"})])]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"success",icon:"el-icon-edit",size:"mini",disabled:"admin"===t.row.username},on:{click:function(r){return e.editUser(t.row)}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:"admin"===t.row.username},on:{click:function(r){return e.deleteUser(t.row)}}})]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.offset,"page-sizes":[10,20,50,100],"page-size":e.queryInfo.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total,"hide-on-single-page":""},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:e.autofocus?"新增用户":"编辑用户",width:"35%",visible:e.dialogVisible},on:{close:function(t){return e.closeDialog("addUserRef")}}},[r("el-form",{ref:"addUserRef",attrs:{model:e.addUser,rules:e.addUserRule,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{attrs:{autofocus:e.autofocus,clearable:"",disabled:!e.autofocus,"prefix-icon":"iconfont icon-account"},model:{value:e.addUser.username,callback:function(t){e.$set(e.addUser,"username",t)},expression:"addUser.username"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{autofocus:e.autofocus,clearable:"","prefix-icon":"iconfont icon-account"},model:{value:e.addUser.email,callback:function(t){e.$set(e.addUser,"email",t)},expression:"addUser.email"}})],1),e.autofocus?e._e():r("el-form-item",{attrs:{label:"重置密码"}},[r("el-switch",{attrs:{"active-text":"是","inactive-text":"否"},model:{value:e.swithValue,callback:function(t){e.swithValue=t},expression:"swithValue"}})],1),!e.autofocus&&!e.swithValue?e._e():r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{staticStyle:{width:"226.4px"},attrs:{type:"password","show-password":"",clearable:"","prefix-icon":"iconfont icon-password"},model:{value:e.addUser.password,callback:function(t){e.$set(e.addUser,"password",t)},expression:"addUser.password"}}),r("el-button",{staticStyle:{"margin-left":"20px",width:"180px"},attrs:{type:"info",size:"medium"},on:{click:e.makePwd}},[e._v(" "+e._s(e.autofocus?"生成随机密码":"重置密码")+" ")])],1),r("el-form-item",{attrs:{label:"角色",prop:"role"}},[r("el-select",{attrs:{placeholder:"请选择角色"},on:{change:e.getRole},model:{value:e.addUser.role,callback:function(t){e.$set(e.addUser,"role",t)},expression:"addUser.role"}},[r("el-option",{attrs:{label:"admin",value:"admin"}}),r("el-option",{attrs:{label:"DBA",value:"DBA"}}),r("el-option",{attrs:{label:"主管",value:"主管"}}),r("el-option",{attrs:{label:"员工",value:"员工"}})],1)],1),r("el-form-item",{attrs:{label:"部门",prop:"role_id"}},[r("el-select",{attrs:{placeholder:"请选择部门"},model:{value:e.addUser.role_id,callback:function(t){e.$set(e.addUser,"role_id",t)},expression:"addUser.role_id"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{label:e.department,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-radio",{attrs:{label:"正常"},model:{value:e.addUser.status,callback:function(t){e.$set(e.addUser,"status",t)},expression:"addUser.status"}},[e._v("正常")]),r("el-radio",{attrs:{label:"锁定"},model:{value:e.addUser.status,callback:function(t){e.$set(e.addUser,"status",t)},expression:"addUser.status"}},[e._v("锁定")])],1),r("el-form-item",[r("el-row",[r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.closeDialog("addUserRef")}}},[e._v("取消")])],1),r("el-col",{attrs:{push:10,span:16}},[e.autofocus?r("el-button",{attrs:{type:"info"},on:{click:function(t){return e.resetForm("addUserRef")}}},[e._v("重置 ")]):e._e(),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.commitForm("addUserRef")}}},[e._v("提交")])],1)],1)],1)],1)],1)],1)],1)},fe=[],ge={name:"User",data:function(){return{tableData:[],queryInfo:{offset:1,limit:10,user:""},addUser:{username:"",email:"",status:"正常",password:"",role_id:"",role:""},userid:0,total:0,dialogVisible:!1,addUserRule:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:12,message:"密码长度在6-12个字符",trigger:"blur"}],role_id:[{required:!0,message:"请选择用户部门",trigger:"change"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}]},options:[],resetPwd:!1,autofocus:!0,swithValue:!1}},mounted:function(){this.getUser()},methods:{deleteUser:function(e){var t=this;this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e),r.next=3,t.$ajax.delete("/user/?id=".concat(e.id));case 3:if(a=r.sent,n=a.data,"success"==n.msg){r.next=7;break}return r.abrupt("return",t.message.error("删除失败"));case 7:t.getUser(),t.$message({type:"success",message:"删除成功!"});case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},editUser:function(e){this.getRole(),this.autofocus=!1,this.userid=e.id,this.addUser.username=e.username,this.addUser.password="",this.addUser.status=e.status,this.addUser.role_id=e.role_id,this.addUser.role=e.role,this.dialogVisible=!0},makePwd:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/pwd/");case 2:r=t.sent,a=r.data,e.addUser.password=a.data;case 5:case"end":return t.stop()}}),t)})))()},commitForm:function(e){var t=this;this.$refs[e].validate(function(){var r=Object(g["a"])(regeneratorRuntime.mark((function r(a){var n,s,l,o,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a){r.next=2;break}return r.abrupt("return",t.$message.error("请正确填写完整信息"));case 2:if(!t.autofocus){r.next=16;break}return n=t.addUser,delete n.role,r.next=7,t.$ajax.post("/user/",n).catch((function(){return t.$notify.error({title:"错误",message:"发起添加用户失败"})}));case 7:if(s=r.sent,l=s.data,"success"==l.msg){r.next=11;break}return r.abrupt("return",t.$message.error("添加新用户失败"));case 11:t.getUser(),t.closeDialog(e),t.$message.success("添加新用户成功"),r.next=28;break;case 16:return n=t.addUser,delete n.role,n.id=t.userid,r.next=21,t.$ajax.patch("/user/",n);case 21:if(o=r.sent,i=o.data,"success"==i.msg){r.next=25;break}return r.abrupt("return",t.$message.error("修改用户信息失败"));case 25:t.getUser(),t.closeDialog(e),t.$message.success("修改用户信息成功");case 28:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},resetForm:function(e){this.addUser.role_id="",this.addUser.username="",this.addUser.password="",this.addUser.status="正常",this.addUser.role="",this.$refs[e].clearValidate()},closeDialog:function(e){this.dialogVisible=!1,this.autofocus=!0,this.resetForm(e)},handlerAddUser:function(){this.getRole(),this.dialogVisible=!0},inputChange:function(){this.getUser()},handleCurrentChange:function(e){this.queryInfo.offset=e,this.getUser()},handleSizeChange:function(e){this.queryInfo.limit=e,this.getUser()},getUser:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/user/",{params:e.queryInfo});case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取用户列表失败"));case 6:e.tableData=a.data,e.total=a.total;case 8:case"end":return t.stop()}}),t)})))()},getRole:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.addUser.role_id="",t.next=3,e.$ajax.get("/role/?role=".concat(e.addUser.role));case 3:if(r=t.sent,a=r.data,"success"==a.msg){t.next=7;break}return t.abrupt("return",e.$message.error("获取角色列表失败"));case 7:e.options=a.data;case 8:case"end":return t.stop()}}),t)})))()}}},he=ge,_e=(r("4e3d"),Object(u["a"])(he,be,fe,!1,null,"56665b4a",null)),ve=_e.exports,xe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("我的工单")])],1),r("el-card",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary",href:"/api/v1/download_rollbacksql/"+t.row.id+"/",target:"_blank"}},[e._v("下载回滚sql语句")]),r("el-table",{attrs:{data:t.row.sql,size:"mini",border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"SQL","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql)}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")]),r("el-button",{attrs:{type:"info",size:"mini",round:""},on:{click:function(r){return e.get_rollbacksql(t.row)}}},[e._v("查看回滚语句")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"实际审批人",prop:"approved",align:"center","header-align":"center",width:"150px"}}),r("el-table-column",{attrs:{label:"影响行数",prop:"affected_rows","header-align":"center"}}),r("el-table-column",{attrs:{label:"执行时间/s",prop:"execute_time","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批进度","header-align":"center",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("el-steps",{staticClass:"steps_class",attrs:{active:e.row.status_code,"finish-status":"success","process-status":e.row.remark?"error":"process","align-center":""}},[r("el-step",{attrs:{title:"提交工单"}}),r("el-step",{attrs:{title:"审批",description:e.row.remark&&1===e.row.status_code?e.row.remark:""}}),"rollbacked"===e.row.remark?r("el-step",{attrs:{title:"已回滚",icon:"el-icon-refresh-left",status:"finish"}}):r("el-step",{attrs:{title:"执行",description:e.row.remark&&2===e.row.status_code?e.row.remark.slice(0,100):""}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.remark.slice(0,100))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){e.alert_remark(t.row.remark.slice(0,1e3))}}},[e._v("查看全部")])]}}],null,!0)})],1)]}}])}),r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批上级",prop:"approver_manager",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批dba",prop:"approver_dba",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起时间",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},we=[],ke={data:function(){return{tableData:[],tableData_sqllist:[],offset:1,offset_sqllist:1,limit:10,limit_sqllist:10,total:0,total_sqllist:0,sql_id:0}},mounted:function(){this.get_workorder()},methods:{handleSizeChange:function(e){this.offset=1,this.limit=e,this.get_workorder()},handleCurrentChange:function(e){this.offset=e,this.get_workorder()},get_workorder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/workorder/?offset=".concat(e.offset,"&limit=").concat(e.limit)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求工单失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取工单失败"));case 6:e.tableData=a.data,e.total=a.total;case 8:case"end":return t.stop()}}),t)})))()},handleSizeChange_sqllist:function(e){this.offset_sqllist=1,this.limit_sqllist=e,this.sql_list()},handleCurrentChange_sqllist:function(e){this.offset_sqllist=e,this.sql_list()},sql_list:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.get("/sql_list/".concat(e,"/?offset=").concat(t.offset_sqllist,"&limit=").concat(t.limit_sqllist)).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("获取失败"));case 6:t.tableData_sqllist=n.data,t.total_sqllist=n.total;case 8:case"end":return r.stop()}}),r)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},alert_remark:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$alert("<pre>"+e+"</pre>","remark",{dangerouslyUseHTMLString:!0});case 2:case"end":return r.stop()}}),r)})))()},get_rollbacksql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/get_rollbacksql/".concat(e.id,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.alert_sql(n.data);case 8:case"end":return r.stop()}}),r)})))()}}},ye=ke,$e=(r("9112b"),r("34fc"),Object(u["a"])(ye,xe,we,!1,null,null,null)),Re=$e.exports,qe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("待审批")])],1),r("el-card",[r("h1",[e._v("待审批工单列表")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"success",icon:"iconfont icon-zhihang",size:"medium"},on:{click:function(r){return e.exec_all_sql(t.row.id)}}},[e._v("全部执行 ")]),r("el-button",{attrs:{type:"danger",icon:"iconfont icon-zhihang",size:"medium"},on:{click:function(r){return e.rejectOrder_all(t.row.sql)}}},[e._v("全部驳回 ")]),r("el-table",{attrs:{data:t.row.sql,size:"mini",border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"SQL","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql.slice(0,50))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"预计影响行数",prop:"affected_rows","header-align":"center"}}),r("el-table-column",{attrs:{label:"预计执行时间/s",prop:"execute_time","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批进度","header-align":"center",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("el-steps",{staticClass:"steps_class",attrs:{active:e.row.status_code,"finish-status":"success","process-status":e.row.remark?"error":"process","align-center":""}},[r("el-step",{attrs:{title:"提交工单"}}),r("el-step",{attrs:{title:"审批",description:e.row.remark&&1===e.row.status_code?e.row.remark:""}}),r("el-step",{attrs:{title:"执行",description:e.row.remark&&2===e.row.status_code?e.row.remark:""}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{label:"备注",prop:"remark","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"iconfont icon-zhihang",size:"mini"},on:{click:function(r){return e.commitOrder(t.row)}}},[e._v("执行 ")]),r("el-button",{attrs:{type:"danger",icon:"iconfont icon-bohui",size:"mini"},on:{click:function(r){return e.rejectOrder(t.row)}}},[e._v("驳回 ")])]}}],null,!0)})],1)]}}])}),r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起人",prop:"sponsor",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起时间",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}})],1),r("h1",[e._v("osc信息列表")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.ocstableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库名",prop:"DBNAME",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"表名",prop:"TABLENAME",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"SQL","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.COMMAND)}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.COMMAND)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"执行进度百分比",prop:"PERCENT",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"剩余时间",prop:"REMAINTIME",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"warning",icon:"iconfont icon-zhihang",size:"mini"},on:{click:function(r){return e.pause_osc(t.row.SQLSHA1)}}},[e._v("暂停 ")]),r("el-button",{attrs:{type:"primary",icon:"iconfont icon-zhihang",size:"mini"},on:{click:function(r){return e.resume_osc(t.row.SQLSHA1)}}},[e._v("恢复 ")]),r("el-button",{attrs:{type:"danger",icon:"iconfont icon-bohui",size:"mini"},on:{click:function(r){return e.kill_osc(t.row.SQLSHA1)}}},[e._v("终止 ")])]}}])})],1),r("h1",[e._v("待审批数据导出工单列表")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data_export_tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起人",prop:"sponsor",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sql",prop:"sql",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql.slice(0,100))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"发起时间",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"iconfont icon-zhihang",size:"mini"},on:{click:function(r){return e.mod_data_export_status(t.row.id,1)}}},[e._v("通过 ")]),r("el-button",{attrs:{type:"danger",icon:"iconfont icon-bohui",size:"mini"},on:{click:function(r){return e.mod_data_export_status(t.row.id,2)}}},[e._v("驳回 ")])]}}])})],1),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.get_workorder(),e.get_osc()}}},[e._v("手动刷新 ")]),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[5,10,20,50],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},je=[],De=(r("d3b7"),r("ddb0"),{inject:["reload"],data:function(){return{tableData:[],offset:1,limit:5,total:0,ocstableData:[],data_export_tableData:[],timer:""}},mounted:function(){this.get_workorder(),this.get_osc(),this.get_workorder_data_export(),this.timer=setInterval(this.get_osc,1e4)},beforeDestroy:function(){clearInterval(this.timer)},methods:{handleSizeChange:function(e){this.limit=e,this.get_workorder(),this.get_osc()},handleCurrentChange:function(e){this.offset=e,this.get_workorder(),this.get_osc()},commitOrder:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/execsql/".concat(e.id,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起SQL执行操作失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg&&n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.get_workorder();case 8:t.$message.success("SQL已放后台执行中，请稍后刷新页面查看是否执行完成！");case 9:case"end":return r.stop()}}),r)})))()},rejectOrder:function(e){var t=this;this.$prompt("请输入驳回理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[^\s]+/,inputErrorMessage:"请输入内容"}).then(function(){var r=Object(g["a"])(regeneratorRuntime.mark((function r(a){var n,s,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=a.value,r.next=3,t.$ajax.post("/sqlrecord/".concat(e.id,"/?remark=").concat(n)).catch((function(){return t.$notify.error({title:"错误",message:"发起驳回操作失败"})}));case 3:if(s=r.sent,l=s.data,"success"===l.msg){r.next=7;break}return r.abrupt("return",t.$message.error("驳回操作失败"));case 7:return t.$message.success("已驳回该工单"),r.next=10,t.get_workorder();case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(){t.$message({type:"info",message:"取消输入"})}))},get_workorder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/pending/?offset=".concat(e.offset,"&limit=").concat(e.limit)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求工单失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取工单失败"));case 6:e.tableData=a.data,e.total=a.total;case 8:case"end":return t.stop()}}),t)})))()},get_osc:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_osc/").catch((function(){return e.$notify.error({title:"错误",message:"发起请求osc失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取osc失败"));case 6:e.ocstableData=a.data,e.ocstableData.forEach((function(e){e.PERCENT=e.PERCENT+"%"}));case 8:case"end":return t.stop()}}),t)})))()},pause_osc:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/pause_osc/",{SQLSHA1:e}).catch((function(){return t.$notify.error({title:"错误",message:"发起暂停osc请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("暂停osc失败"));case 6:case"end":return r.stop()}}),r)})))()},resume_osc:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/resume_osc/",{SQLSHA1:e}).catch((function(){return t.$notify.error({title:"错误",message:"发起恢复osc请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("恢复osc失败"));case 6:case"end":return r.stop()}}),r)})))()},kill_osc:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/kill_osc/",{SQLSHA1:e}).catch((function(){return t.$notify.error({title:"错误",message:"发起终止osc请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("终止osc失败"));case 6:case"end":return r.stop()}}),r)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},get_workorder_data_export:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/data_export_pending/?offset=".concat(e.offset,"&limit=").concat(e.limit)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求工单失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取工单失败"));case 6:e.data_export_tableData=a.data,e.total=a.total;case 8:case"end":return t.stop()}}),t)})))()},mod_data_export_status:function(e,t){var r=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){var n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$ajax.post("/mod_data_export_status/",{id:e,status:t}).catch((function(){return r.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(n=a.sent,s=n.data,"success"===s.msg){a.next=6;break}return a.abrupt("return",r.$message.error("请求失败"));case 6:return r.$message.success("成功"),a.next=9,r.get_workorder_data_export();case 9:case"end":return a.stop()}}),a)})))()},exec_all_sql1:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:r.t0=regeneratorRuntime.keys(e);case 1:if((r.t1=r.t0()).done){r.next=12;break}return a=r.t1.value,r.next=5,t.$ajax.post("/execsql/".concat(e[a].id,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起SQL执行操作失败"})}));case 5:if(n=r.sent,s=n.data,"success"===s.msg&&s.msg){r.next=9;break}return r.abrupt("return",t.$message.error(s.msg));case 9:t.$message.success("SQL已放后台执行中，请稍后刷新页面查看是否执行完成！"),r.next=1;break;case 12:return r.next=14,t.get_workorder();case 14:case"end":return r.stop()}}),r)})))()},exec_all_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/execsql_all/".concat(e,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起SQL执行操作失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg&&n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return t.$message.success("SQL已放后台执行中，请稍后刷新页面查看是否执行完成！"),r.next=9,t.get_workorder();case 9:case"end":return r.stop()}}),r)})))()},rejectOrder_all:function(e){var t=this;this.$prompt("请输入驳回理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[^\s]+/,inputErrorMessage:"请输入内容"}).then(function(){var r=Object(g["a"])(regeneratorRuntime.mark((function r(a){var n,s,l,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=a.value,r.t0=regeneratorRuntime.keys(e);case 2:if((r.t1=r.t0()).done){r.next=12;break}return s=r.t1.value,r.next=6,t.$ajax.post("/sqlrecord/".concat(e[s].id,"/?remark=").concat(n)).catch((function(){return t.$notify.error({title:"错误",message:"发起驳回操作失败"})}));case 6:if(l=r.sent,o=l.data,"success"===o.msg){r.next=10;break}return r.abrupt("return",t.$message.error("驳回操作失败"));case 10:r.next=2;break;case 12:return t.$message.success("已驳回该工单"),r.next=15,t.get_workorder();case 15:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(){t.$message({type:"info",message:"取消输入"})}))}}}),Se=De,Ce=(r("123a"),r("ebb6"),Object(u["a"])(Se,qe,je,!1,null,"6c2746b2",null)),Oe=Ce.exports,Ie=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("历史工单")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("span",{staticClass:"demonstration"},[e._v(" - 选择日期: ")]),r("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.datetimevalue,callback:function(t){e.datetimevalue=t},expression:"datetimevalue"}}),e._v(" - "),r("el-form-item",{attrs:{label:"用户名"}},[r("el-input",{attrs:{placeholder:"user"},model:{value:e.sponsor,callback:function(t){e.sponsor=t},expression:"sponsor"}})],1),e._v(" - "),r("el-form-item",{attrs:{label:"host"}},[r("el-input",{attrs:{placeholder:"host"},model:{value:e.host,callback:function(t){e.host=t},expression:"host"}})],1),e._v(" - "),r("el-form-item",{attrs:{label:"数据库名"}},[r("el-input",{attrs:{placeholder:"dbname"},model:{value:e.dbname,callback:function(t){e.dbname=t},expression:"dbname"}})],1),r("el-checkbox",{model:{value:e.is_check,callback:function(t){e.is_check=t},expression:"is_check"}},[e._v("查看是否检查")]),e._v(" - "),r("el-button",{attrs:{type:"primary"},on:{click:e.get_workorder}},[e._v("搜索")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary",href:"/api/v1/download_rollbacksql/"+t.row.id+"/",target:"_blank"}},[e._v("下载回滚sql语句")]),r("el-table",{attrs:{data:t.row.sql,size:"mini",border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"SQL","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql)}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")]),r("el-button",{attrs:{type:"info",size:"mini",round:""},on:{click:function(r){return e.get_rollbacksql(t.row)}}},[e._v("查看回滚语句")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"实际审批人",prop:"approved"}}),r("el-table-column",{attrs:{label:"影响行数",prop:"affected_rows","header-align":"center"}}),r("el-table-column",{attrs:{label:"执行时间/s",prop:"execute_time","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批进度","header-align":"center",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("el-steps",{staticClass:"steps_class",attrs:{active:e.row.status_code,"finish-status":"success","process-status":e.row.remark?"error":"process","align-center":""}},[r("el-step",{attrs:{title:"提交工单"}}),r("el-step",{attrs:{title:"审批",description:e.row.remark&&1===e.row.status_code?e.row.remark:""}}),"rollbacked"===e.row.remark?r("el-step",{attrs:{title:"已回滚",icon:"el-icon-refresh-left",status:"finish"}}):r("el-step",{attrs:{title:"执行",description:e.row.remark&&2===e.row.status_code?e.row.remark.slice(0,100):""}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{label:"备注","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.remark.slice(0,100))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){e.alert_remark(t.row.remark.slice(0,1e3))}}},[e._v("查看全部")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"el-icon-refresh-left",size:"mini"},on:{click:function(r){return e.rollbackOrder(t.row)}}},[e._v("回滚 ")]),r("el-button",{attrs:{type:"info",size:"mini",round:""},on:{click:function(r){return e.get_rollbacksql(t.row)}}},[e._v("查看回滚语句")])]}}],null,!0)})],1)]}}])}),r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起人",prop:"sponsor",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审核人",prop:"approver_manager",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审核dba",prop:"approver_dba",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起时间",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"is_check",label:"是否检查",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_check?r("el-tag",{staticClass:"iconfont icon-zhengchang",attrs:{type:"success"}}):e._e(),0===t.row.is_check?r("el-tag",{staticClass:"iconfont icon-yichang",attrs:{type:"danger"}}):e._e(),0===t.row.is_check?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.order_mark_check(t.row.id)}}},[e._v("点击标记检查 ")]):e._e()]}}])})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},Te=[],Ee={data:function(){return{tableData:[],offset:1,limit:10,total:0,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},datetimevalue:[],is_check:2,sponsor:"",host:"",dbname:""}},mounted:function(){this.get_workorder()},methods:{handleSizeChange:function(e){this.limit=e,this.get_workorder()},handleCurrentChange:function(e){this.offset=e,this.get_workorder()},get_workorder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return!0===e.is_check?r=1:!1===e.is_check?r=0:2===e.is_check&&(r=2),a="",n="",e.datetimevalue&&e.datetimevalue.length>1&&(s=new Date(e.datetimevalue[0]),l=new Date(e.datetimevalue[1]),a=Date.parse(s)/1e3,n=Date.parse(l)/1e3),t.next=6,e.$ajax.get("/historyorder/?offset=".concat(e.offset,"&limit=").concat(e.limit,"&is_check=").concat(r,"&start_time=").concat(a,"&end_time=").concat(n,"&sponsor=").concat(e.sponsor,"&host=").concat(e.host,"&dbname=").concat(e.dbname)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求历史工单失败"})}));case 6:if(o=t.sent,i=o.data,"success"===i.msg){t.next=10;break}return t.abrupt("return",e.$message.error("获取历史工单失败"));case 10:e.tableData=i.data,e.total=i.total;case 12:case"end":return t.stop()}}),t)})))()},rollbackOrder:function(e){var t=this;if(""!==e.remark&&3!==e.status_code||"rollbacked"===e.remark)return this.$notify.error({title:"错误",message:"只能回滚已执行成功的SQL"});this.$confirm("此操作将回滚该SQL, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/rollbacksql/".concat(e.id,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起回滚操作失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return t.$message({type:"success",message:"回滚成功!"}),r.next=9,t.get_workorder();case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消回滚操作"})}))},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},alert_remark:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$alert("<pre>"+e+"</pre>","remark",{dangerouslyUseHTMLString:!0});case 2:case"end":return r.stop()}}),r)})))()},get_rollbacksql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/get_rollbacksql/".concat(e.id,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.alert_sql(n.data);case 8:case"end":return r.stop()}}),r)})))()},order_mark_check:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/order_mark_check/".concat(e,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.get_workorder();case 8:case"end":return r.stop()}}),r)})))()}}},Ve=Ee,ze=(r("129f"),r("3ee3"),Object(u["a"])(Ve,Ie,Te,!1,null,"00e60d82",null)),He=ze.exports,Le=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("goInception配置管理")]),r("el-breadcrumb-item",[e._v("审核规则")])],1),e._m(0),r("el-card",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数名",prop:"Variable_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数值",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.Value,callback:function(r){e.$set(t.row,"Value",r)},expression:"scope.row.Value"}})]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.inception_set(t.row.Variable_name,t.row.Value)}}},[e._v("修改")])]}}])})],1)],1)],1)},Ue=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a",{attrs:{href:"https://hanchuanchuan.github.io/goInception/zh/options.html",target:"_blank"}},[r("h1",[e._v("查看参数的解释")])])}],Fe={data:function(){return{tableData:[]}},mounted:function(){this.get_inception_show_variables()},methods:{get_inception_show_variables:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_inception_show_variables/").catch((function(){return e.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取失败"));case 6:e.tableData=a.data;case 7:case"end":return t.stop()}}),t)})))()},inception_set:function(e,t){var r=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){var n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$ajax.post("/set_inception_show_variables/",{Variable_name:e,Value:t}).catch((function(){return r.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(n=a.sent,s=n.data,"success"===s.msg){a.next=6;break}return a.abrupt("return",r.$message.error("设置失败"));case 6:return r.$message({message:"修改成功",type:"success"}),a.next=9,r.get_inception_show_variables();case 9:case"end":return a.stop()}}),a)})))()}}},Pe=Fe,Ae=Object(u["a"])(Pe,Le,Ue,!1,null,"a95cf9e4",null),Me=Ae.exports,Ne=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("goInception配置管理")]),r("el-breadcrumb-item",[e._v("自定义审核级别")])],1),r("el-card",[r("div",{attrs:{align:""}},[r("p",[e._v("对应审核结果的 "),r("code",[e._v("error_level")]),e._v(" 字段：")]),r("ul",[r("li",[r("code",[e._v("2")]),e._v(" 为错误，即强限制，无法执行")]),r("li",[r("code",[e._v("1")]),e._v(" 为警告，即弱限制，可通过忽略警告参数"),r("code",[e._v("ignore_warnings")]),e._v("跳过")]),r("li",[r("code",[e._v("0")]),e._v(" 为正常，即不做限制")])])]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数中文名",prop:"Desc",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数名",prop:"Name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数值",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.Value,callback:function(r){e.$set(t.row,"Value",r)},expression:"scope.row.Value"}})]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.inception_set(t.row.Name,t.row.Value)}}},[e._v("修改")])]}}])})],1)],1)],1)},Be=[],Qe={data:function(){return{tableData:[]}},mounted:function(){this.get_inception_show_levels()},methods:{get_inception_show_levels:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_inception_show_levels/").catch((function(){return e.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取失败"));case 6:e.tableData=a.data;case 7:case"end":return t.stop()}}),t)})))()},inception_set:function(e,t){var r=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){var n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$ajax.post("/set_inception_show_levels/",{Name:e,Value:t}).catch((function(){return r.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(n=a.sent,s=n.data,"success"==s.msg){a.next=6;break}return a.abrupt("return",r.$message.error("设置失败"));case 6:return r.$message({message:"修改成功",type:"success"}),a.next=9,r.get_inception_show_levels();case 9:case"end":return a.stop()}}),a)})))()}}},We=Qe,Ge=Object(u["a"])(We,Ne,Be,!1,null,"4d131ee1",null),Xe=Ge.exports,Ke=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("我的数据导出工单")])],1),r("el-card",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批上级",prop:"approver_manager",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批dba",prop:"approver_dba",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sql",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql.slice(0,10))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"状态",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?r("el-tag",{attrs:{type:"info"}},[r("span",{staticClass:"el-icon-success"},[e._v("待审批")])]):e._e(),1==t.row.status?r("el-tag",{attrs:{type:"success"}},[r("span",{staticClass:"el-icon-success"},[e._v("通过")])]):e._e(),2==t.row.status?r("el-tag",{attrs:{type:"danger"}},[r("span",{staticClass:"el-icon-error"},[e._v("驳回")])]):e._e(),3==t.row.status?r("el-tag",{attrs:{type:"success"}},[r("span",{staticClass:"el-icon-success"},[e._v("已下载")])]):e._e()]}}])}),r("el-table-column",{attrs:{label:"链接",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.status?r("el-link",{attrs:{type:"primary",href:t.row.path,target:"_blank"}},[e._v("下载链接")]):e._e()]}}])}),r("el-table-column",{attrs:{label:"发起时间",width:"110",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批时间",width:"110",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status>=1?r("span",{attrs:{type:"primary"}},[e._v(e._s(t.row.approve_time))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"下载时间",width:"110",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.status?r("span",{attrs:{type:"primary"}},[e._v(e._s(t.row.download_time))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},Ye=[],Je={data:function(){return{tableData:[],offset:1,limit:10,total:0}},mounted:function(){this.get_workorder()},methods:{handleSizeChange:function(e){this.offset=1,this.limit=e,this.get_workorder()},handleCurrentChange:function(e){this.offset=e,this.get_workorder()},get_workorder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/workorder_data_export/?offset=".concat(e.offset,"&limit=").concat(e.limit)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求工单失败"})}));case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取工单失败"));case 6:e.tableData=a.data,e.total=a.total;case 8:case"end":return t.stop()}}),t)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e=B.a.format(e),e=W.a.highlight("sql",e).value,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 3:case"end":return r.stop()}}),r)})))()},alert_remark:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$alert("<pre>"+e+"</pre>","remark",{dangerouslyUseHTMLString:!0});case 1:case"end":return r.stop()}}),r)})))()}}},Ze=Je,et=(r("912c"),r("985a"),Object(u["a"])(Ze,Ke,Ye,!1,null,null,null)),tt=et.exports,rt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("历史数据导出工单")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("span",{staticClass:"demonstration"},[e._v(" - 选择日期: ")]),r("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.datetimevalue,callback:function(t){e.datetimevalue=t},expression:"datetimevalue"}}),e._v(" - "),r("el-form-item",{attrs:{label:"用户名"}},[r("el-input",{attrs:{placeholder:"user"},model:{value:e.sponsor,callback:function(t){e.sponsor=t},expression:"sponsor"}})],1),e._v(" - "),r("el-form-item",{attrs:{label:"host"}},[r("el-input",{attrs:{placeholder:"host"},model:{value:e.host,callback:function(t){e.host=t},expression:"host"}})],1),e._v(" - "),r("el-form-item",{attrs:{label:"数据库名"}},[r("el-input",{attrs:{placeholder:"dbname"},model:{value:e.dbname,callback:function(t){e.dbname=t},expression:"dbname"}})],1),r("el-checkbox",{model:{value:e.is_check,callback:function(t){e.is_check=t},expression:"is_check"}},[e._v("查看是否检查")]),e._v(" - "),r("el-button",{attrs:{type:"primary"},on:{click:e.get_workorder}},[e._v("搜索")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"发起人",prop:"sponsor",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审核人",prop:"approver_manager",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审核dba",prop:"approver_dba",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例地址",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sql",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql.slice(0,10))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"状态",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?r("el-tag",{attrs:{type:"info"}},[r("span",{staticClass:"el-icon-success"},[e._v("待审批")])]):e._e(),1==t.row.status?r("el-tag",{attrs:{type:"success"}},[r("span",{staticClass:"el-icon-success"},[e._v("通过")])]):e._e(),2==t.row.status?r("el-tag",{attrs:{type:"danger"}},[r("span",{staticClass:"el-icon-error"},[e._v("驳回")])]):e._e(),3==t.row.status?r("el-tag",{attrs:{type:"success"}},[r("span",{staticClass:"el-icon-success"},[e._v("已下载")])]):e._e()]}}])}),r("el-table-column",{attrs:{label:"链接",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.status?r("el-link",{attrs:{type:"primary",href:t.row.path,target:"_blank"}},[e._v("下载链接")]):e._e()]}}])}),r("el-table-column",{attrs:{label:"发起时间",width:"110",prop:"create_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"审批时间",width:"110",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status>=1?r("span",{attrs:{type:"primary"}},[e._v(e._s(t.row.approve_time))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"下载时间",width:"110",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.status?r("span",{attrs:{type:"primary"}},[e._v(e._s(t.row.download_time))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"工单说明",prop:"remark",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"is_check",label:"是否检查",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_check?r("el-tag",{staticClass:"iconfont icon-zhengchang",attrs:{type:"success"}}):e._e(),0===t.row.is_check?r("el-tag",{staticClass:"iconfont icon-yichang",attrs:{type:"danger"}}):e._e(),0===t.row.is_check?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.order_mark_check(t.row.id)}}},[e._v("点击标记检查 ")]):e._e()]}}])})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},at=[],nt={data:function(){return{tableData:[],offset:1,limit:10,total:0,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},datetimevalue:[],is_check:2,sponsor:"",host:"",dbname:""}},mounted:function(){this.get_workorder()},methods:{handleSizeChange:function(e){this.limit=e,this.get_workorder()},handleCurrentChange:function(e){this.offset=e,this.get_workorder()},get_workorder:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return!0===e.is_check?r=1:!1===e.is_check?r=0:2===e.is_check&&(r=2),a="",n="",e.datetimevalue&&e.datetimevalue.length>1&&(s=new Date(e.datetimevalue[0]),l=new Date(e.datetimevalue[1]),a=Date.parse(s)/1e3,n=Date.parse(l)/1e3),t.next=6,e.$ajax.get("/historyorder_data_export/?offset=".concat(e.offset,"&limit=").concat(e.limit,"&is_check=").concat(r,"&start_time=").concat(a,"&end_time=").concat(n,"&sponsor=").concat(e.sponsor,"&host=").concat(e.host,"&dbname=").concat(e.dbname)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求历史工单失败"})}));case 6:if(o=t.sent,i=o.data,"success"===i.msg){t.next=10;break}return t.abrupt("return",e.$message.error("获取历史工单失败"));case 10:e.tableData=i.data,e.total=i.total;case 12:case"end":return t.stop()}}),t)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e=B.a.format(e),e=W.a.highlight("sql",e).value,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 3:case"end":return r.stop()}}),r)})))()},alert_remark:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$alert("<pre>"+e+"</pre>","remark",{dangerouslyUseHTMLString:!0});case 2:case"end":return r.stop()}}),r)})))()},order_mark_check:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/data_export_order_mark_check/".concat(e,"/")).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.get_workorder();case 8:case"end":return r.stop()}}),r)})))()}}},st=nt,lt=(r("4c85"),r("27b5"),Object(u["a"])(st,rt,at,!1,null,"5aab997e",null)),ot=lt.exports,it=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("脱敏字段管理")]),r("el-breadcrumb-item",[e._v("获取脱敏字段列表")])],1),r("el-card",[r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:e.handlerAdd}},[e._v("添加")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例名称",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"字段",prop:"field",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return e.handlerDelete(t.row)}}})]}}])})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[5,10,20,50],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"添加脱敏字段",visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[r("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRule,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"实例名称",prop:"instance_id"}},[r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择实例地址"},on:{change:function(t){return e.get_db()}},model:{value:e.formData.instance_id,callback:function(t){e.$set(e.formData,"instance_id",t)},expression:"formData.instance_id"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",{attrs:{label:"数据库",prop:"dbname"}},[r("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择数据库"},model:{value:e.formData.dbname,callback:function(t){e.$set(e.formData,"dbname",t)},expression:"formData.dbname"}},e._l(e.dbs,(function(e){return r("el-option",{key:e.db,attrs:{value:e.db,label:e.db}})})),1)],1),r("el-form-item",{attrs:{label:"字段",prop:"field"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容","prefix-icon":"iconfont icon-duankoutance",clearable:""},model:{value:e.formData.field,callback:function(t){e.$set(e.formData,"field",t)},expression:"formData.field"}})],1),r("el-form-item",[r("el-row",{attrs:{gutter:15}},[r("el-col",{attrs:{span:10}},[r("el-button",{on:{click:function(t){return e.handleCancel()}}},[e._v("取消")])],1),r("el-col",{attrs:{span:13}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handlerCommit("formRef")}}},[e._v("确 定")])],1)],1)],1)],1)],1)],1)},ct=[],ut={data:function(){return{tableData:[],offset:1,limit:5,total:0,dialogTitle:"添加脱敏字段",dialogVisible:!1,formData:{instance_id:"",dbname:"",field:""},formRule:{instance_id:[{required:!0,message:"请选择实例",trigger:"change"}],dbname:[{required:!0,message:"请选择数据库",trigger:"change"}],field:[{required:!0,message:"请输入字段",trigger:"blur"}]},dbs:[]}},mounted:function(){this.get_desensitization_info_list(),this.get_ins()},methods:{handleSizeChange:function(e){this.limit=e,this.get_desensitization_info_list()},handleCurrentChange:function(e){this.offset=e,this.get_desensitization_info_list()},handlerAdd:function(){this.dialogVisible=!0,this.autofocus=!0},handleCancel:function(){this.dialogVisible=!1},get_desensitization_info_list:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_desensitization_info_list/?offset=".concat(e.offset,"&limit=").concat(e.limit)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取失败"));case 6:e.tableData=a.data,e.total=a.count;case 8:case"end":return t.stop()}}),t)})))()},get_db:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dbs=[],e.tabs=[],t.next=4,e.$ajax.get("/get_schema/?id=".concat(e.formData.instance_id)).catch((function(){return e.$notify.error({title:"错误",message:"获取数据库失败，请检查实例连接配置"})}));case 4:if(r=t.sent,a=r.data,"success"===a.msg){t.next=8;break}return t.abrupt("return",e.$message.error("获取数据库失败，请检查实例连接状态"));case 8:e.dbs=a.data;case 9:case"end":return t.stop()}}),t)})))()},get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_ins/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"==a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},handlerCommit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.$message.error("请正确填写必要信息"));case 2:return e.next=4,t.$ajax.post("/add_desensitization_info/",{id:t.formData.instance_id,dbname:t.formData.dbname,field:t.formData.field}).catch((function(){t.$notify.error({title:"错误",message:"请求失败"})}));case 4:if(a=e.sent,n=a.data,"success"==n.msg){e.next=9;break}return t.isRet=!1,e.abrupt("return",t.$message.error(n.msg));case 9:return t.dialogVisible=!1,e.next=12,t.get_desensitization_info_list();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},handlerDelete:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.delete("/del_desensitization_info/".concat(e.id));case 2:if(a=r.sent,n=a.data,"success"==n.msg){r.next=6;break}return r.abrupt("return",t.message.error("删除失败"));case 6:return r.next=8,t.get_desensitization_info_list();case 8:t.$message({type:"success",message:"删除成功!"});case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}}},dt=ut,mt=(r("b0ab"),r("d804"),Object(u["a"])(dt,it,ct,!1,null,"1abd2eef",null)),pt=mt.exports,bt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("慢日志管理")]),r("el-breadcrumb-item",[e._v("慢日志信息列表")])],1),r("el-card",[r("div",{staticClass:"block"},[r("span",{staticClass:"demonstration"},[e._v(" - 选择实例: ")]),r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择实例"},model:{value:e.dbid,callback:function(t){e.dbid=t},expression:"dbid"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.id+"/"+e.ins_name+"/"+e.host}})})),1),r("span",{staticClass:"demonstration"},[e._v(" - 选择日期: ")]),r("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.datetimevalue,callback:function(t){e.datetimevalue=t},expression:"datetimevalue"}})],1),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search_("get_slowlog")}}},[e._v("搜索")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search_("get_slowlog_count_top30")}}},[e._v("出现频率top30")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search_("get_slowlog_time_top30")}}},[e._v("耗时最长top30")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sql_pattern",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql_pattern.slice(0,100))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql_pattern)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"orig_sql",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.orig_sql.slice(0,100))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.orig_sql)}}},[e._v("查看全部sql")]),r("el-button",{attrs:{type:"success",size:"mini",round:""},on:{click:function(r){return e.sqlscore(t.row)}}},[e._v("获取优化建议")])]}}])}),e._l(e.tableLabel,(function(e){return r("el-table-column",{key:e,attrs:{align:"center","header-align":"center",prop:e,label:e,"show-overflow-tooltip":""}})}))],2),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:"SQL审核结果",visible:e.dialogVisible,width:"75%"},on:{close:e.closeDialog}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"min-height":"500px"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("markdown-it-vue",{attrs:{content:e.result}}),e.loading?e._e():r("el-row",[r("el-col",{attrs:{push:18}},[r("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("关闭")])],1)],1)],1)])],1)],1)},ft=[],gt={components:{MarkdownItVue:X.a},data:function(){return{tableData:[],offset:1,limit:10,total:0,dbid:"",options:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},datetimevalue:[],tableLabel:[],search_value:"get_slowlog",queryInfo:{selectHost:"",selectDb:"",sql:"",offset:0,limit:0,limit2:0},result:"",loading:!0}},mounted:function(){this.search_(this.search_value),this.get_ins()},methods:{handleSizeChange:function(e){this.offset=1,this.limit=e,this.search_(this.search_value)},handleCurrentChange:function(e){this.offset=e,this.search_(this.search_value)},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},search_:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n,s,l,o,i,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.search_value=e,a=t.dbid,""===t.dbid&&(a=0),n="",s="",t.datetimevalue&&t.datetimevalue.length>1&&(l=new Date(t.datetimevalue[0]),o=new Date(t.datetimevalue[1]),n=Date.parse(l)/1e3,s=Date.parse(o)/1e3),r.next=8,t.$ajax.get("/".concat(e,"?offset=").concat(t.offset,"&limit=").concat(t.limit,"&dbid=").concat(a,"&start_time=").concat(n,"&end_time=").concat(s)).catch((function(){return t.$notify.error({title:"错误",message:"发起请求失败"})}));case 8:if(i=r.sent,c=i.data,"success"===c.msg){r.next=12;break}return r.abrupt("return",t.$message.error("获取失败"));case 12:t.tableData=c.data,t.total=c.total,0!==c.total&&(t.tableLabel=Object.keys(c.data[0]));case 15:case"end":return r.stop()}}),r)})))()},get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},sqlscore:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.queryInfo.sql=e.orig_sql,t.queryInfo.selectHost=e.dbid,t.queryInfo.selectDb=e.db_user,t.dialogVisible=!0,r.next=6,t.$ajax.post("/sqlscore/",t.queryInfo).catch((function(){t.$notify.error({title:"错误",message:"提交失败"})}));case 6:if(a=r.sent,n=a.data,"success"===n.msg){r.next=10;break}return r.abrupt("return",t.$message.error("SQL审核失败"));case 10:t.result=n.data.join(""),t.loading=!1;case 12:case"end":return r.stop()}}),r)})))()},closeDialog:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogVisible=!1,e.result="",e.loading=!0;case 3:case"end":return t.stop()}}),t)})))()}}},ht=gt,_t=(r("a09d"),r("5cd9"),Object(u["a"])(ht,bt,ft,!1,null,null,null)),vt=_t.exports,xt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("工单管理")]),r("el-breadcrumb-item",[e._v("历史查询记录")])],1),r("el-card",[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:8}},[r("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.datetimevalue,callback:function(t){e.datetimevalue=t},expression:"datetimevalue"}})],1),r("el-col",{attrs:{span:4}},[r("el-input",{attrs:{clearable:"","prefix-icon":"el-icon-search",placeholder:"输入用户名"},model:{value:e.sponsor,callback:function(t){e.sponsor=t},expression:"sponsor"}})],1),r("el-col",{attrs:{span:4}},[r("el-input",{attrs:{clearable:"","prefix-icon":"el-icon-search",placeholder:"输入数据库名"},model:{value:e.dbname,callback:function(t){e.dbname=t},expression:"dbname"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:e.get_query_log}},[e._v("搜索")])],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"用户",prop:"username",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"实例",prop:"ins_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"数据库",prop:"dbname",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sql",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.sql.slice(0,50))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.sql)}}},[e._v("查看全部sql")])]}}])}),r("el-table-column",{attrs:{label:"时间",prop:"create_time",align:"center","header-align":"center"}})],1),r("el-pagination",{attrs:{"current-page":e.offset,"page-sizes":[10,20,50,100],"page-size":e.limit,"hide-on-single-page":!0,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},wt=[],kt={data:function(){return{tableData:[],offset:1,limit:10,total:0,sponsor:"",dbname:"",pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},datetimevalue:[]}},mounted:function(){this.get_query_log()},methods:{handleSizeChange:function(e){this.offset=1,this.limit=e,this.get_query_log()},handleCurrentChange:function(e){this.offset=e,this.get_query_log()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},get_query_log:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="",a="",e.datetimevalue&&e.datetimevalue.length>1&&(n=new Date(e.datetimevalue[0]),s=new Date(e.datetimevalue[1]),r=Date.parse(n)/1e3,a=Date.parse(s)/1e3),t.next=5,e.$ajax.get("/get_query_log?offset=".concat(e.offset,"&limit=").concat(e.limit,"&sponsor=").concat(e.sponsor,"&dbname=").concat(e.dbname,"&start_time=").concat(r,"&end_time=").concat(a)).catch((function(){return e.$notify.error({title:"错误",message:"发起请求失败"})}));case 5:if(l=t.sent,o=l.data,"success"===o.msg){t.next=9;break}return t.abrupt("return",e.$message.error("获取失败"));case 9:e.tableData=o.data,e.total=o.total;case 11:case"end":return t.stop()}}),t)})))()}}},yt=kt,$t=(r("8c15"),r("dded4"),Object(u["a"])(yt,xt,wt,!1,null,null,null)),Rt=$t.exports,qt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("会话管理")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.processlist},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",{attrs:{label:"选择command_type"}},[r("el-select",{attrs:{placeholder:"command_type"},on:{change:e.processlist},model:{value:e.command_type,callback:function(t){e.command_type=t},expression:"command_type"}},e._l(["Query","Not Sleep","All"],(function(e){return r("el-option",{key:e,attrs:{value:e,label:e}})})),1)],1),r("el-form-item",{attrs:{label:"数据库名"}},[r("el-input",{attrs:{placeholder:"数据库名"},model:{value:e.database,callback:function(t){e.database=t},expression:"database"}})],1),r("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消选择")]),r("el-button",{attrs:{type:"primary"},on:{click:e.processlist}},[e._v("搜索")]),r("el-button",{attrs:{type:"danger"},on:{click:e.kill_session_select}},[e._v("终止选中会话")])],1),r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"tooltip-effect":"dark",data:e.tbs,border:"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{label:"#",type:"selection",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"THEEAD ID",prop:"id",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"USER",prop:"user",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"HOST",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"DATABASE",prop:"db",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"TIME/s",prop:"time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"COMMAND",prop:"command",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"STATE",prop:"state",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"INFO",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.info.slice(0,50))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.info)}}},[e._v("查看全部sql")]),r("el-button",{attrs:{type:"success",size:"mini",round:""},on:{click:function(r){return e.sqlscore(t.row)}}},[e._v("获取优化建议")])]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"danger",size:"mini",round:""},on:{click:function(r){return e.kill_session(t.row.id)}}},[e._v("kill")])]}}])})],1),r("el-dialog",{attrs:{title:"SQL审核结果",visible:e.dialogVisible,width:"75%"},on:{close:e.closeDialog}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"min-height":"500px"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("markdown-it-vue",{attrs:{content:e.result}}),e.loading?e._e():r("el-row",[r("el-col",{attrs:{push:18}},[r("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("关闭")])],1)],1)],1)])],1)],1)},jt=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Dt={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[],command_type:"Query",multipleSelection:[],database:"",queryInfo:{selectHost:"",selectDb:"",sql:"",offset:0,limit:0,limit2:0},result:"",loading:!0}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},sqlFormat:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.editor.setValue(B.a.format(e.editor.getValue()));case 1:case"end":return t.stop()}}),t)})))()},processlist:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/processlist/",{id:e.selectHost,command_type:e.command_type,database:e.database}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()},handleSelectionChange:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.multipleSelection=e;case 1:case"end":return r.stop()}}),r)})))()},toggleSelection:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:console.log(t.multipleSelection),e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):t.$refs.multipleTable.clearSelection();case 2:case"end":return r.stop()}}),r)})))()},kill_session:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/kill_session/",{id:t.selectHost,threadID:e}).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:case"end":return r.stop()}}),r)})))()},kill_session_select:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(e.multipleSelection),t.t0=regeneratorRuntime.keys(e.multipleSelection);case 2:if((t.t1=t.t0()).done){t.next=8;break}return r=t.t1.value,t.next=6,e.kill_session(e.multipleSelection[r].id);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)})))()},sqlscore:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.queryInfo.sql=e.info,t.queryInfo.selectHost=t.selectHost,t.queryInfo.selectDb=e.db,t.dialogVisible=!0,r.next=6,t.$ajax.post("/sqlscore/",t.queryInfo).catch((function(){t.$notify.error({title:"错误",message:"提交失败"})}));case 6:if(a=r.sent,n=a.data,"success"===n.msg){r.next=10;break}return r.abrupt("return",t.$message.error("SQL审核失败"));case 10:t.result=n.data.join(""),t.loading=!1;case 12:case"end":return r.stop()}}),r)})))()},closeDialog:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogVisible=!1,e.result="",e.loading=!0;case 3:case"end":return t.stop()}}),t)})))()}}},St=Dt,Ct=(r("d8d4"),Object(u["a"])(St,qt,jt,!1,null,null,null)),Ot=Ct.exports,It=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("Top表空间")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.tablesapce},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-button",{attrs:{type:"primary"},on:{click:e.tablesapce}},[e._v("刷新")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"数据库",prop:"table_schema",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"表名",prop:"table_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"存储引擎",prop:"engine",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"总空间(MB)",prop:"total_size",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"行数",prop:"table_rows",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"数据空间(MB)",prop:"data_size",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"索引空间(MB)",prop:"index_size",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"碎片空间(MB)",prop:"data_free",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{sortable:"",label:"碎片率(%)",prop:"pct_free",align:"center","header-align":"center"}})],1)],1)],1)},Tt=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Et={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[]}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},tablesapce:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/tablesapce/",{id:e.selectHost}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()}}},Vt=Et,zt=(r("9e5f"),Object(u["a"])(Vt,It,Tt,!1,null,null,null)),Ht=zt.exports,Lt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("事务信息")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.innodb_trx},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-button",{attrs:{type:"primary"},on:{click:e.innodb_trx}},[e._v("刷新")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"trx_id",prop:"trx_id",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_started",prop:"trx_started",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_idle_time",prop:"trx_idle_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_state",prop:"trx_state",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"user",prop:"user",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"host",prop:"host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"db",prop:"db",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_mysql_thread_id",prop:"trx_mysql_thread_id",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_operation_state",prop:"trx_operation_state",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_tables_locked",prop:"trx_tables_locked",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_rows_locked",prop:"trx_rows_locked",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_rows_modified",prop:"trx_rows_modified",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_is_read_only",prop:"trx_is_read_only",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"trx_isolation_level",prop:"trx_isolation_level",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"thread_time",prop:"thread_time",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"INFO",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.info.slice(0,50))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_sql(t.row.info)}}},[e._v("查看全部sql")])]}}])})],1)],1)],1)},Ut=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Ft={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[]}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},innodb_trx:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/innodb_trx/",{id:e.selectHost}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()},alert_sql:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=B.a.format(e),e=W.a.highlight("sql",e).value,r.next=4,t.$alert("<pre>"+e+"</pre>","sql",{dangerouslyUseHTMLString:!0});case 4:case"end":return r.stop()}}),r)})))()}}},Pt=Ft,At=(r("1ff7"),Object(u["a"])(Pt,Lt,Ut,!1,null,null,null)),Mt=At.exports,Nt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("锁信息")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.innodb_trx},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-button",{attrs:{type:"primary"},on:{click:e.innodb_trx}},[e._v("刷新")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},e._l(e.tbs,(function(e){return r("el-table-column",{key:e,attrs:{align:"center","header-align":"center",prop:e,label:e,"show-overflow-tooltip":""}})})),1)],1)],1)},Bt=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Qt={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[]}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},innodb_trx:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/trxandlocks/",{id:e.selectHost}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()}}},Wt=Qt,Gt=(r("1d9d"),Object(u["a"])(Wt,Nt,Bt,!1,null,null,null)),Xt=Gt.exports,Kt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("数据库账号管理")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.instance_user_list},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-button",{attrs:{type:"primary"},on:{click:e.instance_user_list}},[e._v("刷新")]),r("el-button",{attrs:{type:"success"},on:{click:function(t){e.instance_user_create_dialogFormVisible=!0,e.instance_user_create_form.instance_id=e.selectHost}}},[e._v("+创建账号 ")])],1),r("el-dialog",{attrs:{title:"创建账号",visible:e.instance_user_create_dialogFormVisible},on:{"update:visible":function(t){e.instance_user_create_dialogFormVisible=t}}},[r("el-form",{ref:"instance_user_create_form",staticClass:"demo-ruleForm",attrs:{model:e.instance_user_create_form,rules:e.instance_user_create_rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"实例地址",prop:"instance_id"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},model:{value:e.instance_user_create_form.instance_id,callback:function(t){e.$set(e.instance_user_create_form,"instance_id",t)},expression:"instance_user_create_form.instance_id"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",{attrs:{label:"数据库账号",prop:"user"}},[r("el-input",{model:{value:e.instance_user_create_form.user,callback:function(t){e.$set(e.instance_user_create_form,"user",t)},expression:"instance_user_create_form.user"}})],1),r("el-form-item",{attrs:{label:"主机",prop:"host"}},[r("el-input",{model:{value:e.instance_user_create_form.host,callback:function(t){e.$set(e.instance_user_create_form,"host",t)},expression:"instance_user_create_form.host"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password1"}},[r("el-input",{attrs:{"show-password":""},model:{value:e.instance_user_create_form.password1,callback:function(t){e.$set(e.instance_user_create_form,"password1",t)},expression:"instance_user_create_form.password1"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"password2"}},[r("el-input",{attrs:{"show-password":""},model:{value:e.instance_user_create_form.password2,callback:function(t){e.$set(e.instance_user_create_form,"password2",t)},expression:"instance_user_create_form.password2"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.instance_user_create_dialogFormVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.instance_user_create("instance_user_create_form")}}},[e._v("创建")])],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},[r("el-table-column",{attrs:{width:"300",label:"账号",prop:"user_host",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"权限",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.privileges,(function(t){return r("li",{key:t},[e._v(" "+e._s(t[0])+" "),r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(r){return e.revoke(t[0])}}},[e._v("回收权限")])],1)}))}}])}),r("el-table-column",{attrs:{width:"300",label:"操作",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){e.grant_dialogFormVisible=!0,e.grant_form.user_host=t.row.user_host,e.grant_form.instance_id=e.selectHost}}},[e._v("授权 ")]),r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(r){e.instance_user_reset_pwd_dialogFormVisible=!0,e.instance_user_reset_pwd_form.user_host=t.row.user_host,e.instance_user_reset_pwd_form.instance_id=e.selectHost}}},[e._v(" 改密 ")]),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(r){return e.instance_user_delete(t.row.user_host)}}},[e._v("删除")])]}}])})],1),r("el-dialog",{attrs:{title:"修改密码",visible:e.instance_user_reset_pwd_dialogFormVisible},on:{"update:visible":function(t){e.instance_user_reset_pwd_dialogFormVisible=t}}},[r("el-form",{ref:"instance_user_reset_pwd_form",staticClass:"demo-ruleForm",attrs:{model:e.instance_user_reset_pwd_form,rules:e.instance_user_reset_pwd_rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"实例地址",prop:"instance_id"}},[r("el-select",{attrs:{placeholder:"实例地址",disabled:""},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",{attrs:{label:"数据库账号",prop:"user_host"}},[r("el-input",{attrs:{disabled:""},model:{value:e.instance_user_reset_pwd_form.user_host,callback:function(t){e.$set(e.instance_user_reset_pwd_form,"user_host",t)},expression:"instance_user_reset_pwd_form.user_host"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password1"}},[r("el-input",{attrs:{"show-password":""},model:{value:e.instance_user_reset_pwd_form.password1,callback:function(t){e.$set(e.instance_user_reset_pwd_form,"password1",t)},expression:"instance_user_reset_pwd_form.password1"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"password2"}},[r("el-input",{attrs:{"show-password":""},model:{value:e.instance_user_reset_pwd_form.password2,callback:function(t){e.$set(e.instance_user_reset_pwd_form,"password2",t)},expression:"instance_user_reset_pwd_form.password2"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.instance_user_reset_pwd_dialogFormVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.instance_user_reset_pwd("instance_user_reset_pwd_form")}}},[e._v("修改")])],1)],1),r("el-dialog",{attrs:{title:"授权变更",visible:e.grant_dialogFormVisible},on:{"update:visible":function(t){e.grant_dialogFormVisible=t}}},[r("el-form",{ref:"grant_form",staticClass:"demo-ruleForm",attrs:{model:e.grant_form,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"实例地址",prop:"instance_id"}},[r("el-select",{attrs:{placeholder:"实例地址",disabled:""},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",{attrs:{label:"数据库账号",prop:"user_host"}},[r("el-input",{attrs:{disabled:""},model:{value:e.grant_form.user_host,callback:function(t){e.$set(e.grant_form,"user_host",t)},expression:"grant_form.user_host"}})],1),r("el-form-item",{attrs:{label:"授权类型：",prop:"instance_id"}},[r("el-select",{attrs:{placeholder:"授权类型："},on:{change:function(t){return e.get_db("queryRef")}},model:{value:e.grant_form.priv_type,callback:function(t){e.$set(e.grant_form,"priv_type",t)},expression:"grant_form.priv_type"}},e._l(e.priv_type_li,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),1===e.grant_form.priv_type?r("el-form-item",{attrs:{label:"选择数据库："}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"选择数据库："},model:{value:e.grant_form.db_name,callback:function(t){e.$set(e.grant_form,"db_name",t)},expression:"grant_form.db_name"}},e._l(e.dbs,(function(e){return r("el-option",{key:e.db,attrs:{value:e.db,label:e.db}})})),1)],1):e._e(),2===e.grant_form.priv_type?r("el-form-item",{attrs:{label:"选择数据库："}},[r("el-select",{attrs:{filterable:"",placeholder:"选择数据库："},on:{change:e.getTable},model:{value:e.grant_form.db_name[0],callback:function(t){e.$set(e.grant_form.db_name,0,t)},expression:"grant_form.db_name[0]"}},e._l(e.dbs,(function(e){return r("el-option",{key:e.db,attrs:{value:e.db,label:e.db}})})),1)],1):e._e(),2===e.grant_form.priv_type?r("el-form-item",{attrs:{label:"选择表："}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"选择表："},model:{value:e.grant_form.tb_name,callback:function(t){e.$set(e.grant_form,"tb_name",t)},expression:"grant_form.tb_name"}},e._l(e.tabs,(function(e){return r("el-option",{key:e,attrs:{value:e,label:e}})})),1)],1):e._e(),0===e.grant_form.priv_type?r("div",[r("el-form-item",{attrs:{label:"权限选择："}},[[r("el-checkbox-group",{model:{value:e.grant_form.privs.global_privs,callback:function(t){e.$set(e.grant_form.privs,"global_privs",t)},expression:"grant_form.privs.global_privs"}},[r("el-checkbox-button",{attrs:{disabled:""}},[e._v("数据")]),r("el-checkbox",{attrs:{label:"SELECT"}}),r("el-checkbox",{attrs:{label:"INSERT"}}),r("el-checkbox",{attrs:{label:"UPDATE"}}),r("el-checkbox",{attrs:{label:"DELETE"}}),r("el-checkbox",{attrs:{label:"FILE"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("结构")]),r("el-checkbox",{attrs:{label:"CREATE"}}),r("el-checkbox",{attrs:{label:"ALTER"}}),r("el-checkbox",{attrs:{label:"INDEX"}}),r("el-checkbox",{attrs:{label:"DROP"}}),r("el-checkbox",{attrs:{label:"CREATE TEMPORARY TABLES"}}),r("el-checkbox",{attrs:{label:"SHOW VIEW"}}),r("el-checkbox",{attrs:{label:"CREATE ROUTINE"}}),r("el-checkbox",{attrs:{label:"ALTER ROUTINE"}}),r("el-checkbox",{attrs:{label:"EXECUTE"}}),r("el-checkbox",{attrs:{label:"CREATE VIEW"}}),r("el-checkbox",{attrs:{label:"EVENT"}}),r("el-checkbox",{attrs:{label:"TRIGGER"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("管理")]),r("el-checkbox",{attrs:{label:"GRANT"}}),r("el-checkbox",{attrs:{label:"SUPER"}}),r("el-checkbox",{attrs:{label:"PROCESS"}}),r("el-checkbox",{attrs:{label:"RELOAD"}}),r("el-checkbox",{attrs:{label:"SHUTDOWN"}}),r("el-checkbox",{attrs:{label:"SHOW DATABASES"}}),r("el-checkbox",{attrs:{label:"LOCK TABLES"}}),r("el-checkbox",{attrs:{label:"REFERENCES"}}),r("el-checkbox",{attrs:{label:"REPLICATION CLIENT"}}),r("el-checkbox",{attrs:{label:"REPLICATION SLAVE"}}),r("el-checkbox",{attrs:{label:"CREATE USER"}})],1)]],2)],1):e._e(),1===e.grant_form.priv_type?r("div",[r("el-form-item",{attrs:{label:"权限选择："}},[[r("el-checkbox-group",{model:{value:e.grant_form.privs.db_privs,callback:function(t){e.$set(e.grant_form.privs,"db_privs",t)},expression:"grant_form.privs.db_privs"}},[r("el-checkbox-button",{attrs:{disabled:""}},[e._v("数据")]),r("el-checkbox",{attrs:{label:"SELECT"}}),r("el-checkbox",{attrs:{label:"INSERT"}}),r("el-checkbox",{attrs:{label:"UPDATE"}}),r("el-checkbox",{attrs:{label:"DELETE"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("结构")]),r("el-checkbox",{attrs:{label:"CREATE"}}),r("el-checkbox",{attrs:{label:"ALTER"}}),r("el-checkbox",{attrs:{label:"INDEX"}}),r("el-checkbox",{attrs:{label:"DROP"}}),r("el-checkbox",{attrs:{label:"CREATE TEMPORARY TABLES"}}),r("el-checkbox",{attrs:{label:"SHOW VIEW"}}),r("el-checkbox",{attrs:{label:"CREATE ROUTINE"}}),r("el-checkbox",{attrs:{label:"ALTER ROUTINE"}}),r("el-checkbox",{attrs:{label:"EXECUTE"}}),r("el-checkbox",{attrs:{label:"CREATE VIEW"}}),r("el-checkbox",{attrs:{label:"EVENT"}}),r("el-checkbox",{attrs:{label:"TRIGGER"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("管理")]),r("el-checkbox",{attrs:{label:"GRANT"}}),r("el-checkbox",{attrs:{label:"LOCK TABLES"}}),r("el-checkbox",{attrs:{label:"REFERENCES"}})],1)]],2)],1):e._e(),2===e.grant_form.priv_type?r("div",[r("el-form-item",{attrs:{label:"权限选择："}},[[r("el-checkbox-group",{model:{value:e.grant_form.privs.tb_privs,callback:function(t){e.$set(e.grant_form.privs,"tb_privs",t)},expression:"grant_form.privs.tb_privs"}},[r("el-checkbox-button",{attrs:{disabled:""}},[e._v("数据")]),r("el-checkbox",{attrs:{label:"SELECT"}}),r("el-checkbox",{attrs:{label:"INSERT"}}),r("el-checkbox",{attrs:{label:"UPDATE"}}),r("el-checkbox",{attrs:{label:"DELETE"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("结构")]),r("el-checkbox",{attrs:{label:"CREATE"}}),r("el-checkbox",{attrs:{label:"ALTER"}}),r("el-checkbox",{attrs:{label:"INDEX"}}),r("el-checkbox",{attrs:{label:"DROP"}}),r("el-checkbox",{attrs:{label:"SHOW VIEW"}}),r("el-checkbox",{attrs:{label:"CREATE VIEW"}}),r("el-checkbox",{attrs:{label:"TRIGGER"}}),r("br"),r("el-checkbox-button",{attrs:{disabled:""}},[e._v("管理")]),r("el-checkbox",{attrs:{label:"GRANT"}}),r("el-checkbox",{attrs:{label:"REFERENCES"}})],1)]],2)],1):e._e()],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.grant_dialogFormVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.grant("grant_form")}}},[e._v("提交")])],1)],1)],1)],1)},Yt=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var Jt={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[],instance_user_create_dialogFormVisible:!1,instance_user_create_form:{instance_id:this.selectHost,user:"",host:"",password1:"",password2:""},instance_user_create_rules:{instance_id:[{required:!0,message:"请选择实例",trigger:"change"}],user:[{required:!0,message:"请输入用户名",trigger:"blur"}],host:[{required:!0,message:"请输入主机",trigger:"blur"}],password1:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码长度在 8 到 16 个字符",trigger:"blur"}],password2:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码长度在 8 到 16 个字符",trigger:"blur"}]},instance_user_reset_pwd_rules:{password1:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码长度在 8 到 16 个字符",trigger:"blur"}],password2:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码长度在 8 到 16 个字符",trigger:"blur"}]},instance_user_reset_pwd_form:{instance_id:this.selectHost,user_host:"",password1:"",password2:""},instance_user_reset_pwd_dialogFormVisible:!1,grant_form:{instance_id:this.selectHost,user_host:"",priv_type:0,privs:{global_privs:[],db_privs:[],tb_privs:[]},db_name:[],tb_name:[]},grant_dialogFormVisible:!1,priv_type_li:[{id:0,name:"全局权限"},{id:1,name:"库权限"},{id:2,name:"表权限"}],dbs:[],tabs:[]}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},instance_user_list:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/instance_user_list/",{id:e.selectHost}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()},instance_user_create:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=13;break}return e.next=3,t.$ajax.post("/instance_user_create/",t.instance_user_create_form).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 3:if(a=e.sent,n=a.data,"success"===n.msg){e.next=7;break}return e.abrupt("return",t.$message.error(n.msg));case 7:return t.instance_user_create_dialogFormVisible=!1,t.selectHost=t.instance_user_create_form.instance_id,e.next=11,t.instance_user_list();case 11:e.next=15;break;case 13:return console.log("error submit!!"),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),r)})))()},instance_user_delete:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$confirm("此操作将永久删除该记录, 是否继续?","提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/instance_user_delete/",{instance_id:t.selectHost,user_host:e}).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.instance_user_list();case 8:case"end":return r.stop()}}),r)}))));case 1:case"end":return r.stop()}}),r)})))()},revoke:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$confirm("此操作将删除改权限, 是否继续?","提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.post("/revoke/",{instance_id:t.selectHost,grant_sql:e}).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:return r.next=8,t.instance_user_list();case 8:case"end":return r.stop()}}),r)}))));case 1:case"end":return r.stop()}}),r)})))()},instance_user_reset_pwd:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=10;break}return e.next=3,t.$ajax.post("/instance_user_reset_pwd/",t.instance_user_reset_pwd_form).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 3:if(a=e.sent,n=a.data,"success"===n.msg){e.next=7;break}return e.abrupt("return",t.$message.error(n.msg));case 7:t.instance_user_reset_pwd_dialogFormVisible=!1,e.next=12;break;case 10:return console.log("error submit!!"),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),r)})))()},get_db:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$ajax.get("/get_schema/?id=".concat(t.selectHost)).catch((function(){return t.$notify.error({title:"错误",message:"获取数据库失败，请检查实例连接配置"})}));case 2:if(r=e.sent,a=r.data,"success"===a.msg){e.next=6;break}return e.abrupt("return",t.$message.error("获取数据库失败，请检查实例连接状态"));case 6:t.dbs=a.data;case 7:case"end":return e.stop()}}),e)})))()},getTable:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_table/?id=".concat(e.selectHost,"&dbname=").concat(e.grant_form.db_name[0]));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("库中数据表获取失败"));case 6:e.tabs=Object.keys(a.data.tables);case 7:case"end":return t.stop()}}),t)})))()},grant:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$ajax.post("/grant/",t.grant_form).catch((function(){return t.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=e.sent,a=r.data,"success"===a.msg){e.next=6;break}return e.abrupt("return",t.$message.error(a.msg));case 6:return t.grant_dialogFormVisible=!1,e.next=9,t.instance_user_list();case 9:case"end":return e.stop()}}),e)})))()}}},Zt=Jt,er=(r("62fc"),Object(u["a"])(Zt,Kt,Yt,!1,null,null,null)),tr=er.exports,rr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("参数配置")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.show_variables},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-form-item",[r("el-input",{attrs:{placeholder:"value"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),r("el-button",{attrs:{type:"primary"},on:{click:e.show_variables}},[e._v("搜索")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"#",type:"index",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数名",prop:"Variable_name",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"参数值",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.Value,callback:function(r){e.$set(t.row,"Value",r)},expression:"scope.row.Value"}})]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.set_global(t.row.Variable_name,t.row.Value)}}},[e._v("修改")])]}}])})],1)],1)],1)},ar=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var nr={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[],value:""}},mounted:function(){this.get_ins()},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},show_variables:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post("/show_variables/",{instance_id:e.selectHost,value:e.value}).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error(a.msg));case 6:e.tbs=a.data;case 7:case"end":return t.stop()}}),t)})))()},set_global:function(e,t){var r=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){var n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$ajax.post("/set_global/",{instance_id:r.selectHost,variable_name:e,value:t}).catch((function(){return r.$notify.error({title:"错误",message:"请求失败"})}));case 2:if(n=a.sent,s=n.data,"success"===s.msg){a.next=6;break}return a.abrupt("return",r.$message.error(s.msg));case 6:return a.next=8,r.show_variables();case 8:case"end":return a.stop()}}),a)})))()}}},sr=nr,lr=(r("0ca5"),Object(u["a"])(sr,rr,ar,!1,null,null,null)),or=lr.exports,ir=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("实例管理")]),r("el-breadcrumb-item",[e._v("实时监控")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("el-form-item",{attrs:{label:"选择实例"}},[r("el-select",{attrs:{placeholder:"请选择实例地址"},on:{change:e.instance_monitor},model:{value:e.selectHost,callback:function(t){e.selectHost=t},expression:"selectHost"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.ins_name+"/"+e.host}})})),1)],1),r("el-button",{attrs:{type:"primary"},on:{click:e.instance_monitor}},[e._v("刷新")])],1),r("el-table",{attrs:{data:e.tbs}},[r("el-table-column",{attrs:{property:"time",label:"时间"}}),r("el-table-column",{attrs:{label:" -QPS- -TPS- "}},[r("el-table-column",{attrs:{property:"ins",label:"ins"}}),r("el-table-column",{attrs:{property:"upd",label:"upd"}}),r("el-table-column",{attrs:{property:"del",label:"del"}}),r("el-table-column",{attrs:{property:"sel",label:"sel"}}),r("el-table-column",{attrs:{property:"iud",label:"iud"}})],1),r("el-table-column",{attrs:{label:"--threads--"}},[r("el-table-column",{attrs:{property:"run",label:"run"}}),r("el-table-column",{attrs:{property:"con",label:"con"}}),r("el-table-column",{attrs:{property:"cre",label:"cre"}}),r("el-table-column",{attrs:{property:"cac",label:"cac"}})],1),r("el-table-column",{attrs:{label:"--bytes--"}},[r("el-table-column",{attrs:{property:"recv",label:"recv"}}),r("el-table-column",{attrs:{property:"send",label:"send"}})],1),r("el-table-column",{attrs:{label:" -Hit%- "}},[r("el-table-column",{attrs:{property:"lor",label:"lor"}}),r("el-table-column",{attrs:{property:"hit",label:"hit"}})],1),r("el-table-column",{attrs:{label:" -innodb rows status- "}},[r("el-table-column",{attrs:{property:"innodb_rows_inserted_diff",label:"ins"}}),r("el-table-column",{attrs:{property:"innodb_rows_updated_diff",label:"upd"}}),r("el-table-column",{attrs:{property:"innodb_rows_deleted_diff",label:"del"}}),r("el-table-column",{attrs:{property:"innodb_rows_read_diff",label:"read"}})],1),r("el-table-column",{attrs:{label:"-innodb bp pages status-"}},[r("el-table-column",{attrs:{property:"data",label:"data"}}),r("el-table-column",{attrs:{property:"free",label:"free"}}),r("el-table-column",{attrs:{property:"dirty",label:"dirty"}}),r("el-table-column",{attrs:{property:"flush",label:"flush"}})],1),r("el-table-column",{attrs:{label:"-innodb data status-"}},[r("el-table-column",{attrs:{property:"reads",label:"reads"}}),r("el-table-column",{attrs:{property:"writes",label:"writes"}}),r("el-table-column",{attrs:{property:"readed",label:"readed"}}),r("el-table-column",{attrs:{property:"written",label:"written"}})],1),r("el-table-column",{attrs:{label:"--innodb log--"}},[r("el-table-column",{attrs:{property:"innodb_os_log_fsyncs_diff",label:"fsyncs"}}),r("el-table-column",{attrs:{property:"innodb_os_log_written_diff",label:"written"}})],1),r("el-table-column",{attrs:{label:"his --log(byte)--  read --query--"}},[r("el-table-column",{attrs:{property:"list",label:"list"}}),r("el-table-column",{attrs:{property:"uflush",label:"uflush"}}),r("el-table-column",{attrs:{property:"uckpt",label:"uckpt"}}),r("el-table-column",{attrs:{property:"view",label:"view"}}),r("el-table-column",{attrs:{property:"inside",label:"inside"}}),r("el-table-column",{attrs:{property:"que",label:"que"}})],1)],1)],1)],1)},cr=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var ur={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[],timer:""}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.get_ins();case 2:return t.t0=setInterval,t.next=5,e.instance_monitor;case 5:t.t1=t.sent,e.timer=(0,t.t0)(t.t1,5e3);case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){clearInterval(this.timer)},methods:{get_ins:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance/").catch((function(){return e.$notify.error({title:"错误",message:"获取实例失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取实例失败"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()},instance_monitor:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/instance_monitor/?id=".concat(e.selectHost));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("请求失败"));case 6:e.tbs.unshift(a.data),e.tbs=e.tbs.slice(0,10);case 8:case"end":return t.stop()}}),t)})))()}}},dr=ur,mr=(r("2e45"),Object(u["a"])(dr,ir,cr,!1,null,null,null)),pr=mr.exports,br=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("SQL执行")]),r("el-breadcrumb-item",[e._v("销量查询")])],1),r("el-card",[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[r("span",{staticClass:"demonstration"},[e._v("选择日期时间:")]),r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",align:"right","picker-options":e.pickerOptions},model:{value:e.date_time,callback:function(t){e.date_time=t},expression:"date_time"}}),r("el-button",{attrs:{type:"primary"},on:{click:e.get_sales_order}},[e._v("查询")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tbs,border:"",stripe:""}},[r("el-table-column",{attrs:{label:"minutess",prop:"minutess",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"orders",prop:"orders",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"sales",prop:"sales",align:"center","header-align":"center"}})],1)],1)],1)},fr=[];r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var gr={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{options:[],selectHost:"",tbs:[],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},date_time:""}},mounted:function(){},methods:{get_sales_order:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=Date.parse(e.date_time)/1e3,t.next=3,e.$ajax.get("/get_sales_order?date_time=".concat(r)).catch((function(){return e.$notify.error({title:"错误",message:"请求失败"})}));case 3:if(a=t.sent,n=a.data,"success"===n.msg){t.next=7;break}return t.abrupt("return",e.$message.error(n.msg));case 7:e.tbs=n.data;case 8:case"end":return t.stop()}}),t)})))()}}},hr=gr,_r=(r("c305"),Object(u["a"])(hr,br,fr,!1,null,null,null)),vr=_r.exports,xr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("SQL执行")]),r("el-breadcrumb-item",[e._v("执行shell")])],1),r("el-card",[r("el-form",{ref:"queryRef",attrs:{model:e.queryInfo,rules:e.queryRules,"label-position":"left"}},[r("el-row",[r("el-col",{attrs:{span:17}},[r("el-form-item",{attrs:{label:"cmd:",prop:"cmd"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.queryInfo.cmd,expression:"queryInfo.cmd"}],ref:"mycode",attrs:{rows:"20"},domProps:{value:e.queryInfo.cmd},on:{input:function(t){t.target.composing||e.$set(e.queryInfo,"cmd",t.target.value)}}})])],1)],1),r("el-row",{attrs:{gutter:60}},[r("el-col",{attrs:{span:6}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.commitForm("queryRef")}}},[e._v("提交")])],1)],1)],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.exec_shell_log_list,border:"",stripe:""}},[r("el-table-column",{attrs:{prop:"create_time",label:"时间",sortable:"",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{prop:"log_name",label:"查看日志",sortable:"",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.tail_exec_shell_log(t.row.log_name)}}},[e._v("查看日志")])]}}])}),r("el-table-column",{attrs:{prop:"cmd",label:"命令",sortable:"",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("pre",[r("div",{domProps:{innerHTML:e._s(t.row.cmd.slice(0,10))}})]),r("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(r){return e.alert_remark(t.row.cmd)}}},[e._v("查看全部命令")])]}}])})],1)],1)},wr=[],kr=r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var yr={components:{MarkdownItVue:X.a},name:"Query",data:function(){return{queryInfo:{cmd:""},exec_shell_log_list:[]}},mounted:function(){this.init(),this.get_exec_shell_log_list()},methods:{init:function(){this.editor=kr.fromTextArea(this.$refs.mycode,{mode:"text/shell",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,theme:"dracula",styleActiveLine:!0,autoRefresh:!0,foldGutter:!0,completeSingle:!1,placeholder:"-- Tips:",extraKeys:{Tab:"autocomplete"},hintOptions:{tables:{}}}),this.editor.setSize("800px","450px")},sqlFormat:function(){this.editor.setValue(B.a.format(this.editor.getValue()))},commitForm:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.queryInfo.cmd=t.editor.getValue(),t.$refs[e].validate(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(r){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.$message.error("请选择/填写必要项"));case 2:return t.queryInfo.cmd=t.editor.getValue(),e.next=5,t.$ajax.post("/exec_shell/",t.queryInfo).catch((function(){return t.$notify.error({title:"请求失败",message:"发起请求失败"})}));case 5:if(a=e.sent,n=a.data,"success"===n.msg){e.next=9;break}return e.abrupt("return",t.$message.error("失败"));case 9:if(!n.data){e.next=12;break}e.next=15;break;case 12:return t.$message.success("提交成功！"),e.next=15,t.get_exec_shell_log_list();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return r.stop()}}),r)})))()},get_exec_shell_log_list:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.get("/get_exec_shell_log_list/").catch((function(){return e.$notify.error({title:"错误",message:"获取失败"})}));case 2:if(r=t.sent,a=r.data,"success"===a.msg){t.next=6;break}return t.abrupt("return",e.$message.error("获取失败"));case 6:e.exec_shell_log_list=a.data;case 7:case"end":return t.stop()}}),t)})))()},tail_exec_shell_log:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax.get("/tail_exec_shell_log/?log_name=".concat(e)).catch((function(){return t.$notify.error({title:"错误",message:"获取失败"})}));case 2:if(a=r.sent,n=a.data,"success"===n.msg){r.next=6;break}return r.abrupt("return",t.$message.error("获取失败"));case 6:return r.next=8,t.alert_remark(n.data);case 8:case"end":return r.stop()}}),r)})))()},alert_remark:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$alert("<pre>"+e+"</pre>","详细",{dangerouslyUseHTMLString:!0});case 2:case"end":return r.stop()}}),r)})))()}}},$r=yr,Rr=(r("9313"),Object(u["a"])($r,xr,wr,!1,null,null,null)),qr=Rr.exports;s["default"].use(p["a"]);var jr=[{path:"/",redirect:"/login"},{path:"/login",name:"登录",component:k},{path:"/index",name:"首页",redirect:"/dashboard",component:D,children:[{path:"/dashboard",name:"首页面板",component:E},{path:"/instances",name:"实例列表",component:P},{path:"/inspect",name:"SQL审核",component:ee},{path:"/select",name:"sql查询",component:oe},{path:"/roles",name:"角色列表",component:pe},{path:"/user",name:"用户列表",component:ve},{path:"/workorder",name:"我的SQL工单",component:Re},{path:"/workorder_data_export",name:"我的数据导出工单",component:tt},{path:"/pending",name:"待审批",component:Oe},{path:"/historyorder",name:"历史SQL工单",component:He},{path:"/historyorder_data_export",name:"历史数据导出工单",component:ot},{path:"/inception_show_variables",name:"审核规则",component:Me},{path:"/inception_show_levels",name:"自定义审核级别",component:Xe},{path:"/get_desensitization_info_list",name:"获取脱敏字段列表",component:pt},{path:"/get_slowlog_list",name:"慢日志列表",component:vt},{path:"/get_query_log",name:"历史查询记录",component:Rt},{path:"/processlist",name:"会话管理",component:Ot},{path:"/tablesapce",name:"Top表空间",component:Ht},{path:"/innodb_trx",name:"事务信息",component:Mt},{path:"/trxandlocks",name:"锁信息",component:Xt},{path:"/instanceaccount",name:"数据库账号管理",component:tr},{path:"/param_list",name:"参数配置",component:or},{path:"/instance_monitor",name:"实时监控",component:pr},{path:"/get_sales_order",name:"sales_order",component:vr},{path:"/exec_shell",name:"执行shell",component:qr}]}],Dr=new p["a"]({routes:jr});Dr.beforeEach((function(e,t,r){if("/login"===e.path)return r();var a=window.sessionStorage.getItem("token");if(!a)return r("/login");r()}));var Sr=Dr,Cr=(r("aede"),r("bc3a")),Or=r.n(Cr),Ir=(r("0109"),r("a7be"),r("f6b6"),r("f417"),r("8f5a"),r("991c"),r("d7d5"),r("313e")),Tr=r.n(Ir);s["default"].use(n.a),s["default"].prototype.$ajax=Or.a,Or.a.defaults.baseURL="/api/v1",Or.a.interceptors.request.use((function(e){return e.headers.Authorization=window.sessionStorage.getItem("token"),e})),s["default"].config.productionTip=!1,new s["default"]({router:Sr,render:function(e){return e(m)}}).$mount("#app"),s["default"].prototype.$echarts=Tr.a},"585a4":function(e,t,r){"use strict";r("0c1a")},"5cd9":function(e,t,r){"use strict";r("27e5")},"62fc":function(e,t,r){"use strict";r("84aa")},7751:function(e,t,r){},"775e":function(e,t,r){},"7e25":function(e,t,r){},"82da":function(e,t,r){},"84aa":function(e,t,r){},"85ec":function(e,t,r){},"8c15":function(e,t,r){"use strict";r("0e4b")},"9112b":function(e,t,r){"use strict";r("7e25")},"912c":function(e,t,r){"use strict";r("46f9")},"92bb":function(e,t,r){},9313:function(e,t,r){"use strict";r("b0e4")},"931a":function(e,t,r){},"941e":function(e,t,r){},"985a":function(e,t,r){"use strict";r("be34")},"9a53":function(e,t,r){"use strict";r("775e")},"9c1e":function(e,t,r){},"9e5f":function(e,t,r){"use strict";r("29fc")},a09d:function(e,t,r){"use strict";r("badf")},a4f7:function(e,t,r){},ac11:function(e,t,r){},aede:function(e,t,r){},b0ab:function(e,t,r){"use strict";r("931a")},b0e4:function(e,t,r){},badf:function(e,t,r){},be34:function(e,t,r){},c002:function(e,t,r){},c305:function(e,t,r){"use strict";r("dbc4")},c4ae:function(e,t,r){},c5269:function(e,t,r){e.exports=r.p+"img/timg.a6011902.jpg"},cf05:function(e,t,r){e.exports=r.p+"img/logo.8951ec59.png"},cf0c:function(e,t,r){},d230:function(e,t,r){},d73e:function(e,t,r){},d804:function(e,t,r){"use strict";r("398e")},d8d4:function(e,t,r){"use strict";r("d230")},dbc4:function(e,t,r){},dcb5:function(e,t,r){},dcef:function(e,t,r){"use strict";r("941e")},dded4:function(e,t,r){"use strict";r("37dc")},e166:function(e,t,r){},ebb6:function(e,t,r){"use strict";r("4f41")},ff1e:function(e,t,r){}});
//# sourceMappingURL=app.64834122.js.map